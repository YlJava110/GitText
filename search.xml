<?xml version="1.0" encoding="utf-8"?>
<search> 
  
    
    <entry>
      <title><![CDATA[Android API Level对应Android版本一览表]]></title>
      <url>/2019/07/05/Android-API-Level%E5%AF%B9%E5%BA%94Android%E7%89%88%E6%9C%AC%E4%B8%80%E8%A7%88%E8%A1%A8/</url>
      <content type="html"><![CDATA[<figure class="image-box">
                <img src="http://nunu03.github.io/2019/07/05/Android-API-Level对应Android版本一览表/api1.jpg" alt="api-1" title class>
                <p>api-1</p>
            </figure>
<a id="more"></a>
<figure class="image-box">
                <img src="http://nunu03.github.io/2019/07/05/Android-API-Level对应Android版本一览表/api2.jpg" alt="api-2" title class>
                <p>api-2</p>
            </figure>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[腾讯加固脱壳使用事例]]></title>
      <url>/2019/07/03/tencentfdex/</url>
      <content type="html"><![CDATA[<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>本文只介绍具体的原理和实现，不涉及Xposed相关技术点。想要了解Xposed具体配置和实现的请参考<a href="http://nunu03.github.io/2019/07/02/xposed/">Xposed的配置与简单使用</a></p>
<a id="more"></a>

<h3 id="直接反编译apk"><a href="#直接反编译apk" class="headerlink" title="直接反编译apk"></a>直接反编译apk</h3><figure class="image-box">
                <img src="http://nunu03.github.io/2019/07/03/tencentfdex/apkjadx.jpg" alt="apk-jadx" title class>
                <p>apk-jadx</p>
            </figure>


<h2 id="脱壳工具FDex2"><a href="#脱壳工具FDex2" class="headerlink" title="脱壳工具FDex2"></a>脱壳工具FDex2</h2><figure class="image-box">
                <img src="http://nunu03.github.io/2019/07/03/tencentfdex/fdex2.jpeg" alt="fdex2" title class>
                <p>fdex2</p>
            </figure>
<figure class="image-box">
                <img src="http://nunu03.github.io/2019/07/03/tencentfdex/dexpath.jpeg" alt="dexpath" title class>
                <p>dexpath</p>
            </figure>
<h3 id="脱壳流程"><a href="#脱壳流程" class="headerlink" title="脱壳流程"></a>脱壳流程</h3><h4 id="第一步、激活"><a href="#第一步、激活" class="headerlink" title="第一步、激活"></a>第一步、激活</h4><p>FDex2和需要脱壳的应用都安装到手机上。在Xposed install模块中勾选FDex2，重启手机。</p>
<h4 id="第二步、选择软件"><a href="#第二步、选择软件" class="headerlink" title="第二步、选择软件"></a>第二步、选择软件</h4><p>然后打开FDex2应用，在应用列表中选择需要脱壳的应用，保存dex即可。</p>
<h4 id="第三步、运行软件"><a href="#第三步、运行软件" class="headerlink" title="第三步、运行软件"></a>第三步、运行软件</h4><p>运行要脱壳的软件，不打开运行软件是无法脱出壳的</p>
<h4 id="第四步、dex目录"><a href="#第四步、dex目录" class="headerlink" title="第四步、dex目录"></a>第四步、dex目录</h4><p>找到dex目录，这里的dex就是脱壳后的dex文件，也就是我即将hook的dex文件。目录一般是/data/user/0/com.luhu.package.xxx。</p>
<h2 id="hook过程"><a href="#hook过程" class="headerlink" title="hook过程"></a>hook过程</h2><p>由于被腾讯加固，所以第一步是需要获取对应ClassLoader；在之后的逆向过程中使用的ClassLoader都是这个ClassLoader。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">if(lpparam.packageName.startsWith(&quot;com.luhu.livexiuwu&quot;))&#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">                        //腾讯加固，需要获取对应classloader</span><br><span class="line">                        XposedHelpers.findAndHookMethod(&quot;com.tencent.StubShell.TxAppEntry&quot;, lpparam.classLoader,</span><br><span class="line">                                &quot;attachBaseContext&quot;, Context.class, new XC_MethodHook() &#123;</span><br><span class="line">                                    @Override</span><br><span class="line">                                    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                                        super.afterHookedMethod(param);</span><br><span class="line">                                        //获取到Context对象，通过这个对象来获取classloader</span><br><span class="line">                                        Context context = (Context) param.args[0];</span><br><span class="line">                                        //获取classloader，之后hook加固后的就使用这个classloader</span><br><span class="line">                                        SecApp.hookLuhu(lpparam,context.getClassLoader());                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                                    &#125;</span><br><span class="line"></span><br><span class="line">                                &#125;);</span><br><span class="line">                    &#125;catch (Exception e)&#123;</span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<h2 id="脱壳原理"><a href="#脱壳原理" class="headerlink" title="脱壳原理"></a>脱壳原理</h2><p>通过Hook ClassLoader的loadClass方法，反射调用getDex方法取得Dex(com.android.dex.Dex类对象)，在将里面的dex写出。<br>脱壳获取dex的关键代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">private static  void fDex(XC_LoadPackage.LoadPackageParam loadPackageParam2)&#123;</span><br><span class="line"></span><br><span class="line">        if(loadPackageParam2.packageName.equals(&quot;com.luhu.livexiuwu&quot;))&#123;</span><br><span class="line"></span><br><span class="line">            try &#123;</span><br><span class="line">                Class Dex=Class.forName(&quot;com.android.dex.Dex&quot;);</span><br><span class="line">                Method Dex_getBytes=Dex.getDeclaredMethod(&quot;getBytes&quot;, new Class[0]);</span><br><span class="line">                Method getDex = Class.forName(&quot;java.lang.Class&quot;).getDeclaredMethod(&quot;getDex&quot;, new Class[0]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                XposedHelpers.findAndHookMethod(&quot;java.lang.ClassLoader&quot;, loadPackageParam2.classLoader, &quot;loadClass&quot;, String.class,boolean.class,new XC_MethodHook()&#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">                        Class cls = (Class) param.getResult();</span><br><span class="line">                     </span><br><span class="line"></span><br><span class="line">                        if (cls != null) &#123;</span><br><span class="line"></span><br><span class="line">                                try &#123;</span><br><span class="line">                                    byte[] bArr = (byte[]) Dex_getBytes.invoke(getDex.invoke(cls, new Object[0]), new Object[0]);</span><br><span class="line">                                   </span><br><span class="line"></span><br><span class="line">                                    if (bArr != null) &#123;</span><br><span class="line"></span><br><span class="line">                                        File apkFileDir = new File(CompatUtil.getSdcardSharedDir(), &quot;lulu&quot;);</span><br><span class="line"></span><br><span class="line">                                        if (!apkFileDir.exists()) &#123;</span><br><span class="line">                                            apkFileDir.mkdirs();</span><br><span class="line">                                        &#125;</span><br><span class="line"></span><br><span class="line">                                        String name = &quot;com.luhu.livexiuwu&quot;+bArr.length+&quot;.dex&quot;;</span><br><span class="line">                                        File file2 = new File(apkFileDir, name);</span><br><span class="line">                                       </span><br><span class="line">                                        if (!file2.exists()) &#123;</span><br><span class="line">                                            FileUtil.writeToFileBy(bArr, file2);</span><br><span class="line">                                        &#125;</span><br><span class="line">                                    &#125;</span><br><span class="line">                                &#125; catch (Exception e3) &#123;</span><br><span class="line">                                    </span><br><span class="line">                                &#125;</span><br><span class="line"></span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125; catch (Throwable e) &#123;</span><br><span class="line">                XposedBridge.log(e);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://mp.weixin.qq.com/s/C44M4XNIlZ43iwI7dl95jw" target="_blank" rel="noopener">java and android 架构</a></p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Xposed </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Xposed的配置与简单使用]]></title>
      <url>/2019/07/02/xposed/</url>
      <content type="html"><![CDATA[<h2 id="Xposed是什么"><a href="#Xposed是什么" class="headerlink" title="Xposed是什么"></a>Xposed是什么</h2><p>官方对此的解释是这样的：<br>“Xposed是一个适用于Android的框架。基于这个框架开发的模块可以改变系统和app应用的行为，而不需要修改APK。这是一个很棒的特性，意味着Xposed模块可以不经过任何修改，安装在各种不同的ROM上。Xposed模块可以很容易的开启和关闭。你只需要激活或者禁用Xposed模块，然后重启手机即可。”</p>
<a id="more"></a>
<h2 id="Hook是什么"><a href="#Hook是什么" class="headerlink" title="Hook是什么"></a>Hook是什么</h2><p>Hook 英文就是「挂钩」的意思.那我们如何使用这个「挂钩」呢？在我们的应用程序种，包括应用触发事件和后台逻辑处理，都是是根据事件流程一步步地向下执行。而「挂钩」的意思，就是在事件传送到终点前截获并监控事件的传输，像个钩子钩上事件一样，并且能够在钩上事件时，处理一些自己特定的事件。</p>
<figure class="image-box">
                <img src="https://upload-images.jianshu.io/upload_images/1820210-151e50cb305a17fa.png?imageMogr2/auto-orient/" alt title class>
                <p></p>
            </figure>
<p>如何理解，例如我们有一个方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">private int getResult(int i, int i2) &#123;</span><br><span class="line">    return i+i2; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>正常情况下，i=1，i2=1，我们能得到2，但是根据上图，现在我们知道利用Hook现在能做些什么了，通过Hook我们可以对参数i，i2进行修改，i=1，i2=2，最终我们得到的结果是3.这就是挂钩的作用。</p>
<p>关于Android中的Hook机制，大致有两个方式：</p>
<p>要 root 权限，直接Hook系统，可以干掉所有的App。</p>
<p>免root权限，但是只能 Hook 自身，对系统其它 App 无能为力。</p>
<h2 id="Xposed接入"><a href="#Xposed接入" class="headerlink" title="Xposed接入"></a>Xposed接入</h2><h3 id="创建工程"><a href="#创建工程" class="headerlink" title="创建工程"></a>创建工程</h3><p>这个工程就是我们的插件工程，也是我们需要激活的Xposed模块工程。在我们的群控项目中，我们的hotB就是我们的模块工程。什么是模块工程，可以理解我们使用Hook挂钩自定义消息体的工程。这个app安装后可以在Xposed app的模块中找到。<figure class="image-box">
                <img src="/.io//chenyulong01/Downloads/xposed/模块.png" alt title class>
                <p></p>
            </figure></p>
<h3 id="导入api"><a href="#导入api" class="headerlink" title="导入api"></a>导入api</h3><p>倒入api比较简单：直接在build.gradle中添加依赖即可：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/* Xposed */</span><br><span class="line">    provided &apos;de.robv.android.xposed:api:82&apos;</span><br><span class="line">    provided &apos;de.robv.android.xposed:api:82:sources&apos;</span><br></pre></td></tr></table></figure>

<p><strong>注意：这里是provided，因为Xposed里已有该jar包内容，再次打包进去会冲突，并导致handleLoadPackage没有回调</strong></p>
<h3 id="修改AndroidManifest-xml文件"><a href="#修改AndroidManifest-xml文件" class="headerlink" title="修改AndroidManifest.xml文件"></a>修改AndroidManifest.xml文件</h3><p>在标签里面加三个meta-data</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- 作为xposed模块 --&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposedmodule&quot; android:value=&quot;true&quot; /&gt;</span><br><span class="line">&lt;!-- Xposed的模块描述 显示在xposed模块列表那里第二行--&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposeddescription&quot; android:value=&quot;HotAX&quot; /&gt;</span><br><span class="line">&lt;!-- XposedBridgeApi的最低版本号 --&gt;</span><br><span class="line">&lt;meta-data android:name=&quot;xposedminversion&quot; android:value=&quot;53&quot; /&gt;</span><br></pre></td></tr></table></figure>

<h3 id="编写hook类"><a href="#编写hook类" class="headerlink" title="编写hook类"></a>编写hook类</h3><p>创建一个类，实现IXposedHookLoadPackage接口，重写handleLoadPackage方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">public class XposedModule implements IXposedHookLoadPackage &#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void handleLoadPackage(final XC_LoadPackage.LoadPackageParam loadPackageParam) throws Throwable &#123;</span><br><span class="line">        if (!loadPackageParam.packageName.startsWith(&quot;com.hotax.autowechat&quot;)) &#123;</span><br><span class="line">            if (loadPackageParam.packageName.startsWith(&quot;com.tencent.mm&quot;)) &#123;</span><br><span class="line">                XposedHelpers.findAndHookMethod(Application.class, &quot;attach&quot;, Context.class, new XC_MethodHook() &#123;</span><br><span class="line">                    @Override</span><br><span class="line">                    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">                    &#125;</span><br><span class="line"></span><br><span class="line">                    @Override</span><br><span class="line">                    protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                        </span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="创建xposed-init文件"><a href="#创建xposed-init文件" class="headerlink" title="创建xposed_init文件"></a>创建xposed_init文件</h3><p>在main/assets目录下创建xposed_init文件，不要后缀名。这个就是模块的入口，只有一行代码，就是说明入口类,这个类就是我们上边的类，在这里我们能打印出所有package。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">com.hotax.autowechat.xposed.XposedModule。</span><br></pre></td></tr></table></figure>

<p>至此，Xposed模块开发的接入就全部完成了。</p>
<h2 id="Hook实现"><a href="#Hook实现" class="headerlink" title="Hook实现"></a>Hook实现</h2><h3 id="hook变量"><a href="#hook变量" class="headerlink" title="hook变量"></a>hook变量</h3><p>hook前</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private static  int staticPrivateInt = 100;</span><br><span class="line">public static  int staticPublicInt = 100;</span><br><span class="line">private static  String staticPrivateString = &quot;staticPrivateString&quot;;</span><br><span class="line">private static  String staticPublicString = &quot;staticPublicString&quot;;</span><br><span class="line"></span><br><span class="line">public  int publicInt = 200;</span><br><span class="line">private int privateInt = 300;</span><br><span class="line">private String privateString = &quot;privateString&quot;;</span><br><span class="line">private String publicString = &quot;publicString&quot;;</span><br></pre></td></tr></table></figure>

<p>hook</p>
<p>获取Class：</p>
<p>final Class&lt;?&gt; clazz = XposedHelpers.findClass(“全路径类名”, loadPackageParam.classLoader);</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.setStaticIntField(clazz, &quot;staticPrivateInt&quot;, 99);</span><br><span class="line">XposedHelpers.setStaticIntField(clazz, &quot;staticPublicInt&quot;, 99);</span><br><span class="line">XposedHelpers.setStaticObjectField(clazz, &quot;staticPrivateString&quot;, &quot;hook_staticPrivateString&quot;);</span><br><span class="line">XposedHelpers.setStaticObjectField(clazz, &quot;staticPublicString&quot;, &quot;hook_staticPublicString&quot;);</span><br><span class="line"></span><br><span class="line">XposedHelpers.setStaticIntField(clazz, &quot;publicInt&quot;, 99);</span><br></pre></td></tr></table></figure>

<p>hook后结果打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">D/HookDemo: staticPrivateInt = 99</span><br><span class="line">D/HookDemo: staticPublicInt = 99</span><br><span class="line">D/HookDemo: staticPrivateString = hook_staticPrivateString</span><br><span class="line">D/HookDemo: staticPublicString = hook_staticPublicString</span><br><span class="line">D/HookDemo: publicInt = 200</span><br><span class="line">D/HookDemo: privateInt = 300</span><br><span class="line">D/HookDemo: privateString = privateString</span><br><span class="line">D/HookDemo: publicString = publicString</span><br></pre></td></tr></table></figure>

<p><strong>结论：XposedHelpers.setStaticObjectField方法只能修改静态变量，非静态变量不能使用此方式修改。否则会报java.lang.NullPointerException:异常；</strong>那非静态变量如何修改呢：例如我们目标程序里有两个方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">public void publicMethod(String value)&#123;    </span><br><span class="line">   Log.d(Tag, &quot;参数打印-publicMethod：&quot; + value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">private void privateMethod(String value)&#123;</span><br><span class="line">   Log.d(Tag, &quot;参数打印-privateMethod：&quot; + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hook非静态变量</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;publicFunc&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">               @Override</span><br><span class="line">               protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                   param.args[0] = &quot;before--------------publicMethod&quot;;</span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;publicInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;privateInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;privateString&quot;, &quot;hook_privateString&quot;);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;publicString&quot;, &quot;hook_publicString&quot;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;staticPrivateInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setIntField(param.thisObject, &quot;staticPublicInt&quot;, 199);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;staticPrivateString&quot;, &quot;hook_-setObjectField-staticPrivateString&quot;);</span><br><span class="line">                   XposedHelpers.setObjectField(param.thisObject, &quot;staticPublicString&quot;, &quot;hook_-setObjectField-staticPublicString&quot;);</span><br><span class="line"></span><br><span class="line">               &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>hook后结果打印</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">参数打印-publicMethod：before--------------publicMethod</span><br><span class="line">D/HookDemo: staticPrivateInt = 199</span><br><span class="line">D/HookDemo: staticPublicInt = 199</span><br><span class="line">D/HookDemo: staticPrivateString = hook_-setObjectField-staticPrivateString</span><br><span class="line">D/HookDemo: staticPublicString = hook_-setObjectField-staticPublicString</span><br><span class="line">D/HookDemo: publicInt = 199</span><br><span class="line">D/HookDemo: privateInt = 199</span><br><span class="line">D/HookDemo: privateString = hook_privateString</span><br><span class="line">D/HookDemo: publicString = hook_publicString</span><br></pre></td></tr></table></figure>

<p><strong>结论：非静态变量的修改只能通过反射某类中的某个方法（方法类型不限）中修改，且静态变量也可以这么修改。</strong></p>
<h3 id="hook方法"><a href="#hook方法" class="headerlink" title="hook方法"></a>hook方法</h3><h5 id="hook构造方法"><a href="#hook构造方法" class="headerlink" title="hook构造方法"></a>hook构造方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">public HookDemo(String value)&#123;</span><br><span class="line">    Log.d(Tag, &quot;参数打印-带参构造方法：&quot; + value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">//Hook有参构造函数，修改参数</span><br><span class="line"> XposedHelpers.findAndHookConstructor(clazz, String.class,  new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;参数打印-带参构造方法：我是修改后的参数&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    XposedBridge.log(&quot;HOOK-After：&quot; +param.args[0]);</span><br><span class="line">                &#125;</span><br><span class="line">  &#125;);</span><br><span class="line">  </span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">D/HookDemo: 参数打印-带参构造方法：我是修改后的参数</span><br><span class="line">D/HookDemo: HOOK-After：参数打印-带参构造方法：我是修改后的参数</span><br></pre></td></tr></table></figure>

<h5 id="hook带返回值的方法"><a href="#hook带返回值的方法" class="headerlink" title="hook带返回值的方法"></a>hook带返回值的方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">public String getHook(String value)&#123;</span><br><span class="line">   return value;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">1、</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;getHook&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;返回值：before--------------gethook&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">&#125;);</span><br><span class="line"> </span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: getHook 返回值 = 返回值：before--------------gethook</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">2、</span><br><span class="line">   XposedHelpers.findAndHookMethod(clazz, &quot;getHook&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">//                    param.args[0] = &quot;返回值：before--------------gethook&quot;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.setResult(&quot;返回值：after--------------gethook&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line"> 执行结果：</span><br><span class="line">D/HookDemo: getHook 返回值 = 返回值：after--------------gethook</span><br></pre></td></tr></table></figure>

<h5 id="hook静态方法"><a href="#hook静态方法" class="headerlink" title="hook静态方法"></a>hook静态方法</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">private static String staticPrivateMethod(String value)&#123;</span><br><span class="line">    Log.d(&quot;HookDemo&quot;, &quot;静态函数--&quot; + value);</span><br><span class="line">    return &quot;静态函数--返回：&quot;+value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"></span><br><span class="line">1、</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;staticPrivateMethod&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;before---&quot;;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">    </span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 静态函数--before---</span><br><span class="line">D/HookDemo: 静态函数--返回：before---</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">2、</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;staticPrivateMethod&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.args[0] = &quot;before---&quot;;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                @Override</span><br><span class="line">                protected void afterHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                    param.setResult(&quot;静态函数--返回：after---&quot;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 静态函数--before---</span><br><span class="line">D/HookDemo: 静态函数--返回：after---</span><br><span class="line"></span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">3、</span><br><span class="line">Object object = XposedHelpers.callStaticMethod(clazz, &quot;staticPrivateMethod&quot;, &quot;callStaticMethod 静态函数调用&quot;);</span><br><span class="line">Log.d(&quot;HookDemo&quot;, &quot;xposed-:staticPrivateFunc:&quot;+object);</span><br><span class="line"></span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 静态函数--callStaticMethod 静态函数调用</span><br><span class="line">D/HookDemo: xposed-:staticPrivateFunc:静态函数--返回：callStaticMethod 静态函数调用</span><br></pre></td></tr></table></figure>

<p><strong>结论：静态方法的修改和其他方法hook方式一样，但是静态方法可以直接通过callStaticMethod进行参数的修改。</strong></p>
<h5 id="Hook复杂的参数"><a href="#Hook复杂的参数" class="headerlink" title="Hook复杂的参数"></a>Hook复杂的参数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">public void paramsClass(ClasName cn, String value,Intent intent,int key,Map map,List list)&#123;  </span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">Class cnClazz  = loadPackageParam.classLoader.loadClass(&quot;com.xxxx. ClasName&quot;);</span><br><span class="line">Class cnMap = XposedHelpers.findClass(&quot;java.util.Map&quot;, loadPackageParam.classLoader);</span><br><span class="line">Class cnArrayList = XposedHelpers.findClass(&quot;java.util.ArrayList&quot;, loadPackageParam.classLoader);</span><br><span class="line"></span><br><span class="line">XposedHelpers.findAndHookMethod(clazz, &quot;paramsClass&quot;, cnClazz, String.class, Intent.class,int.class,Map.class,ArrayList.class new XC_MethodHook() &#123;</span><br><span class="line">    @Override</span><br><span class="line">    protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h5 id="Hook内部类中的函数"><a href="#Hook内部类中的函数" class="headerlink" title="Hook内部类中的函数"></a>Hook内部类中的函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">public class HookDemo &#123;</span><br><span class="line">    private String Tag = &quot;HookDemo&quot;;</span><br><span class="line">    class InnerClass&#123;</span><br><span class="line">        public int innerPublicInt = 10;</span><br><span class="line">        private int innerPrivateInt = 20;</span><br><span class="line">        public InnerClass()&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        public void InnerFunc(String value)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">final Class&lt;?&gt; clazz1 = XposedHelpers.findClass(&quot;com.xxxxxx.HookDemo$InnerClass&quot;, loadPackageParam.classLoader);</span><br><span class="line">XposedHelpers.findAndHookMethod(clazz1, &quot;InnerMethod&quot;, String.class, new XC_MethodHook() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br></pre></td></tr></table></figure>

<p><strong>注：hook内部类中的函数和变量，跟以上的hook方式没有区别，唯一的区别是，XposedHelpers.findClass中的路径名不同。</strong></p>
<h5 id="Hook匿名内部类中的函数"><a href="#Hook匿名内部类中的函数" class="headerlink" title="Hook匿名内部类中的函数"></a>Hook匿名内部类中的函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">anonymousInner(new ClasName() &#123;</span><br><span class="line">            @Override</span><br><span class="line">            public void clasNameMethod(String value) &#123;</span><br><span class="line">        		Log.d(Tag, &quot;匿名类参数修改：get：&quot; + value);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">XposedHelpers.findAndHookMethod(&quot;com.xxxxxx.HookDemo$1&quot;, clazz.getClassLoader(),</span><br><span class="line">                    &quot;clasNameMethod&quot;,String.class, new XC_MethodHook() &#123;</span><br><span class="line">                        @Override</span><br><span class="line">                        protected void beforeHookedMethod(MethodHookParam param) throws Throwable &#123;</span><br><span class="line">                             param.args[0] = &quot;匿名类-参数修改&quot;;                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line">执行结果：</span><br><span class="line">D/HookDemo: 匿名类参数修改：get：匿名类-参数修改</span><br></pre></td></tr></table></figure>

<h5 id="Hook替换函数"><a href="#Hook替换函数" class="headerlink" title="Hook替换函数"></a>Hook替换函数</h5><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">private void repleaceMethod()&#123;</span><br><span class="line">    getHook(&quot;sfdsfs-afsafsf&quot;);</span><br><span class="line">&#125;</span><br><span class="line">-------------------------------------------------------------------</span><br><span class="line"> XposedHelpers.findAndHookMethod(clazz, &quot;repleaceMethod&quot;, new XC_MethodReplacement() &#123;</span><br><span class="line">                @Override</span><br><span class="line">                protected Object replaceHookedMethod(MethodHookParam methodHookParam) throws Throwable &#123;</span><br><span class="line">                    try &#123;</span><br><span class="line">	            			// 直接替换原来要执行的逻辑代码,目标方法就不在执行了</span><br><span class="line">			        &#125; catch (Throwable t) &#123;</span><br><span class="line">			            XposedBridge.log(t);</span><br><span class="line">			        &#125;                    </span><br><span class="line">		       </span><br><span class="line">                &#125;</span><br><span class="line">            &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="替换资源"><a href="#替换资源" class="headerlink" title="替换资源"></a>替换资源</h3><h4 id="IXposedHookZygoteInit"><a href="#IXposedHookZygoteInit" class="headerlink" title="IXposedHookZygoteInit"></a>IXposedHookZygoteInit</h4><p>Hook the initialization of Zygote process(es), from which all the apps are forked.</p>
<p>Implement this interface in your module’s main class in order to be notified when Android is starting up. In IXposedHookZygoteInit, you can modify objects and place hooks that should be applied for every app. Only the Android framework/system classes are available at that point in time. Use null as class loader for XposedHelpers.findAndHookMethod(String, ClassLoader, String, Object…) and its variants.</p>
<p>If you want to hook one/multiple specific apps, use IXposedHookLoadPackage instead.</p>
<p>替换系统框架资源（对所有app 起作用）需要实现 IXposedHookZygoteInit接口的 initZygote 方法，并在该方法中调用Resources.setSystemWideReplacement(…) 方法替换资源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">public class Tutorial2  implements IXposedHookZygoteInit&#123;</span><br><span class="line"></span><br><span class="line">    @Override</span><br><span class="line">    public void initZygote(StartupParam arg0) throws Throwable &#123;</span><br><span class="line">        XResources.setSystemWideReplacement(&quot;android&quot;, &quot;bool&quot;, &quot;config_unplugTurnsOnScreen&quot;, false);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="IXposedHookInitPackageResources"><a href="#IXposedHookInitPackageResources" class="headerlink" title="IXposedHookInitPackageResources"></a>IXposedHookInitPackageResources</h4><p>替换app应用资源需要实现 IXposedHookInitPackageResources 类的<br>andleInitPackageResources方法，并在该方法中调用res.setReplacement(…)方法替换资源，注意在该方法中不要使用XResources.setSystemWideReplacement 方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line"> public void handleInitPackageResources(XC_InitPackageResources.InitPackageResourcesParam resparam) throws Throwable &#123;</span><br><span class="line"></span><br><span class="line">     if (resparam.packageName.equals(&quot;com.example.xposedhooktarget&quot;)) &#123;</span><br><span class="line">         //getClassInfo(clazz);</span><br><span class="line">         resparam.res.setReplacement(&quot;com.xxxxxx.xposedhooktarget&quot;, &quot;string&quot;, &quot;action_test&quot;, &quot;HkTargetTest&quot;);</span><br><span class="line">         resparam.res.setReplacement(&quot;com.example.xposedhooktarget&quot;, &quot;color&quot;, &quot;colorAccent&quot;, R.color.colorPrimary);</span><br><span class="line">resparam.res.setReplacement(&quot;2131165219&quot;, &quot;HkTargetTest-action_text&quot;);</span><br><span class="line">         resparam.res.setReplacement(&quot;com.xxxxxxx.xposedhooktarget&quot;, &quot;mipmap&quot;, &quot;test_icon&quot;, new XResources.DrawableLoader() &#123;</span><br><span class="line">             @Override</span><br><span class="line">             public Drawable newDrawable(XResources res, int id) throws Throwable &#123;</span><br><span class="line">                 Drawable dg = res.getDrawable(R.mipmap.ic_launcher);</span><br><span class="line">                 return dg;</span><br><span class="line">             &#125;</span><br><span class="line">         &#125;);</span><br><span class="line"></span><br><span class="line">     &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure>

<p>还可以替换动画文件等等。</p>
<h3 id="修改布局"><a href="#修改布局" class="headerlink" title="修改布局"></a>修改布局</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">resparam.res.hookLayout(&quot;com.xxxxxx.xposedhooktarget&quot;, &quot;layout&quot;, &quot;activity_main&quot;, new XC_LayoutInflated() &#123;</span><br><span class="line">               @Override</span><br><span class="line">               public void handleLayoutInflated(LayoutInflatedParam liparam) throws Throwable &#123;</span><br><span class="line">                   //增加一个TextView</span><br><span class="line">                   FrameLayout contentview = (FrameLayout) liparam.view;</span><br><span class="line">                   if (contentview != null) &#123;</span><br><span class="line">                       TextView textView = new TextView(contentview.getContext());</span><br><span class="line">                       textView.setText(&quot;修改布局&quot;);</span><br><span class="line">                       contentview.addView(textView);</span><br><span class="line">                   &#125;</span><br><span class="line">                   //修改@+id= bt_text1 的TextView的文案</span><br><span class="line">                   TextView bt_text1 = (TextView) liparam.view.findViewById(</span><br><span class="line">                           liparam.res.getIdentifier(&quot;bt_text1&quot;, &quot;id&quot;, &quot;com.xxxxxx.xposedhooktarget&quot;));</span><br><span class="line">                   bt_text1.setText(&quot;修改布局文本&quot;);</span><br><span class="line">               &#125;</span><br><span class="line">           &#125;);</span><br></pre></td></tr></table></figure>

<h2 id="群控"><a href="#群控" class="headerlink" title="群控"></a>群控</h2><p>需求：被动添加好友。</p>
<p>要求：采用静默的无感知模式。</p>
<p>实现：思路，采用hook添加好友协议的模式，入口在db的hook基础上进行监听验证好友的请求，因为不论什么信息，都会首先会存储与微信的db中。</p>
<p>前提：已经hook了界面的跳转，和打开了微信的log信息。<a href="http://wxc.58corp.com/pages/viewpage.action?pageId=25070673" target="_blank" rel="noopener">详细点击</a>.</p>
<p>过程：在前提下，我们可以得到了三个关于被动添加好友的信息：</p>
<p>1、好友通过验证的界面名称和传递的参数。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">E/hotWeixinHook: ActivityHook; activity=com.tencent.mm.plugin.profile.ui.SayHiWithSnsPermissionUI@a3b6b62, onCreate; getIntent()=Intent</span><br><span class="line">        &#123; cmp=com.tencent.mm/.plugin.profile.ui.SayHiWithSnsPermissionUI (has extras), extra=bundle&#123;</span><br><span class="line">            sayhi_with_sns_perm_send_verify=true,</span><br><span class="line">        room_name=null,</span><br><span class="line">        source_from_user_name=null,</span><br><span class="line">        sayhi_with_sns_perm_add_remark=true,</span><br><span class="line">        source_from_nick_name=null,</span><br><span class="line">        Contact_Nick=大王,</span><br><span class="line">        Contact_User=v1_841761d9ad2fee00bafee3e6c65ec45aef0c541d5c3bacfc2d24acd30fe184f31cd28a41808180cfff4ebd0325d4a1a1@stranger,</span><br><span class="line">        Contact_Scene=15,</span><br><span class="line">        Contact_RemarkName=,</span><br><span class="line">        =false,</span><br><span class="line">        AntispamTicket=v2_6e521f51ae39720c3154a79ba26c689efab115f39b314795f803a2889d76a013e05b3569cdd1f5328da35803ed134968@stranger</span><br><span class="line"></span><br><span class="line">        &#125; &#125;, bundle=bundle&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>2、验证的详细信息</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">MicroMsg.FMessageProvider; setDigest, </span><br><span class="line">fmsgType = 1, fmsgScene = 30, </span><br><span class="line">fmsgContent = </span><br><span class="line">&lt;msg </span><br><span class="line">fromusername=&quot;aibhyi1314521&quot; encryptusername=&quot;v1_4bb4022da882fa9b480543b3a0e48fcc76b5530d371c9defe34a653497843e38@stranger&quot; </span><br><span class="line">fromnickname=&quot;忘记一切&quot; </span><br><span class="line">content=&quot;我是忘记一切&quot; </span><br><span class="line">fullpy=&quot;wangjiyiqie&quot; </span><br><span class="line">shortpy=&quot;WJYQ&quot; </span><br><span class="line">imagestatus=&quot;3&quot; </span><br><span class="line">scene=&quot;30&quot; country=&quot;CN&quot; province=&quot;Hebei&quot; city=&quot;Baoding&quot; </span><br><span class="line">sign=&quot;带走一盏渔火，让他温暖我的双眼。留下一段真情让他停泊在枫桥边&quot; percard=&quot;1&quot; sex=&quot;1&quot; alias=&quot;wuluqi0606&quot; weibo=&quot;&quot; albumflag=&quot;0&quot; albumstyle=&quot;0&quot; albumbgimgid=&quot;&quot; snsflag=&quot;17&quot; </span><br><span class="line">snsbgimgid=&quot;http://shmmsns.qpic.cn/mmsns/CttmTaYSYkS6fvUyDJs0icQ6oRUqibtDIuUylCkHeRHfk4jF7nToTbSYAm5H0z84qh9fHACkovW1c/0&quot; </span><br><span class="line">snsbgobjectid=&quot;12854304281324228767&quot; mhash=&quot;3140af8c3cd25f8db0eaa8815cc2cd95&quot; mfullhash=&quot;3140af8c3cd25f8db0eaa8815cc2cd95&quot; </span><br><span class="line">bigheadimgurl=&quot;http://wx.qlogo.cn/mmhead/ver_1/qKwkYHXZa7iahrsJ2DV7NhuZnrWft9icLTiculKSTJiaJVQvpMPV1dyKH9HuqM3F9picnfZ6dd1ujxxCADH0tHburXhYQBsSP0ZQbD8USaqzXh7c/0&quot; smallheadimgurl=&quot;http://wx.qlogo.cn/mmhead/ver_1/qKwkYHXZa7iahrsJ2DV7NhuZnrWft9icLTiculKSTJiaJVQvpMPV1dyKH9HuqM3F9picnfZ6dd1ujxxCADH0tHburXhYQBsSP0ZQbD8USaqzXh7c/96&quot; ticket=&quot;v2_e57f9519b15cab7743fe81feced778340c7cb4a2c6cbbb361fdd606bbf815478db4e967568ece4fbf27519726dda64492f68992a4e750ef8e4e6e72724f075e8@stranger&quot; </span><br><span class="line">opcode=&quot;2&quot; googlecontact=&quot;&quot; qrticket=&quot;&quot; chatroomusername=&quot;&quot; sourceusername=&quot;&quot; sourcenickname=&quot;&quot;&gt;</span><br><span class="line">&lt;brandlist count=&quot;0&quot; ver=&quot;685330891&quot;&gt;&lt;/brandlist&gt;</span><br><span class="line">&lt;/msg&gt;, </span><br><span class="line">isSend = false</span><br></pre></td></tr></table></figure>

<p>3、存储数据库名称。</p>
<p>MicroMsg.SDK.MAutoStorage; <strong>fmessage_conversation</strong>:get with primary key</p>
<p>4、根据1得到的界面，我们可以查看微信的逆向代码。我是用的jadx-0.7.2，不要用jadx低版本，因为低版本的逆向结果的代码中，不含有我们需要hook的具体类名和方法名。因为微信的包比较大，我们最好把逆向代码导出来，使用的时候用AS打开即可。</p>
<p>5、<br>我们看下点击发送按钮等源代码：（比较长，但是不贴一下，没法说啊）</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line">class C305316 implements OnMenuItemClickListener &#123;</span><br><span class="line">        C305316() &#123;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        public final boolean onMenuItemClick(MenuItem menuItem) &#123;</span><br><span class="line">            final C1138k c8233f;</span><br><span class="line">            SayHiWithSnsPermissionUI sayHiWithSnsPermissionUI;</span><br><span class="line">            Context context;</span><br><span class="line">            if (SayHiWithSnsPermissionUI.this.f97358pqM) &#123;</span><br><span class="line">                int i;</span><br><span class="line">                List linkedList = new LinkedList();</span><br><span class="line">                linkedList.add(SayHiWithSnsPermissionUI.this.userName);</span><br><span class="line">                List linkedList2 = new LinkedList();</span><br><span class="line">                linkedList2.add(Integer.valueOf(SayHiWithSnsPermissionUI.this.f97352pnn));</span><br><span class="line">                String g = SayHiWithSnsPermissionUI.m63520g(SayHiWithSnsPermissionUI.this);</span><br><span class="line">                Map hashMap = new HashMap();</span><br><span class="line">                if (SayHiWithSnsPermissionUI.this.f97357pqL.f28645zEk) &#123;</span><br><span class="line">                    i = 1;</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    i = 0;</span><br><span class="line">                &#125;</span><br><span class="line">                hashMap.put(SayHiWithSnsPermissionUI.this.userName, Integer.valueOf(i));</span><br><span class="line">                C6159x.m11666d(&quot;MicroMsg.SayHiWithSnsPermissionUI&quot;, &quot;select sns permission, %s&quot;, Integer.valueOf(i));</span><br><span class="line">                if (C10044x.m20844Xg(SayHiWithSnsPermissionUI.this.userName)) &#123;</span><br><span class="line">                    c8233f = new C8233f(SayHiWithSnsPermissionUI.this.userName, g, SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(C32536a.f104548xML));</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c8233f, 0);</span><br><span class="line">                    sayHiWithSnsPermissionUI = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f10212eKs), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c8233f);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    final C1138k c31589o = new C31589o(2, linkedList, linkedList2, g, &quot;&quot;, hashMap, SayHiWithSnsPermissionUI.this.chatroomName);</span><br><span class="line">                    String stringExtra = SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(&quot;source_from_user_name&quot;);</span><br><span class="line">                    String stringExtra2 = SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(&quot;source_from_nick_name&quot;);</span><br><span class="line">                    if (!C6135bi.m11498oN(stringExtra)) &#123;</span><br><span class="line">                        c31589o.mo40569fj(stringExtra, stringExtra2);</span><br><span class="line">                    &#125;</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c31589o, 0);</span><br><span class="line">                    SayHiWithSnsPermissionUI sayHiWithSnsPermissionUI2 = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI2.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f10212eKs), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c31589o);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; else if (SayHiWithSnsPermissionUI.this.f97359pqN) &#123;</span><br><span class="line">                String stringExtra3 = SayHiWithSnsPermissionUI.this.getIntent().getStringExtra(&quot;Verify_ticket&quot;);</span><br><span class="line">                if (C10044x.m20844Xg(SayHiWithSnsPermissionUI.this.userName)) &#123;</span><br><span class="line">                    c8233f = new C8234g(SayHiWithSnsPermissionUI.this.userName, stringExtra3);</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c8233f, 0);</span><br><span class="line">                    sayHiWithSnsPermissionUI = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f9343dUY), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c8233f);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125; else &#123;</span><br><span class="line">                    c8233f = new C31589o(SayHiWithSnsPermissionUI.this.userName, stringExtra3, SayHiWithSnsPermissionUI.this.f97352pnn);</span><br><span class="line">                    C32688as.m69428CN().mo13442a(c8233f, 0);</span><br><span class="line">                    sayHiWithSnsPermissionUI = SayHiWithSnsPermissionUI.this;</span><br><span class="line">                    context = SayHiWithSnsPermissionUI.this.mController.f28409xRr;</span><br><span class="line">                    SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f8616dGZ);</span><br><span class="line">                    sayHiWithSnsPermissionUI.f97348inI = C36199h.m82220a(context, SayHiWithSnsPermissionUI.this.getString(C1085R.C1081l.f9343dUY), true, new OnCancelListener() &#123;</span><br><span class="line">                        public final void onCancel(DialogInterface dialogInterface) &#123;</span><br><span class="line">                            C32688as.m69428CN().mo13446c(c8233f);</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>经过一系列判断，我们最终最后定位到通过协议的代码C32688as.m69428CN().mo13442a(c8233f, 0);为啥啊，因为不管是if和else if的的条件我们都能够拿到，怎么拿到，我们可以通过XposedHelpers.getObjectField(param.thisObject, “方法变量”);获得到f97359pqN和f97358pqM的值；然后我们看C32688as这个类：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">/* renamed from: com.tencent.mm.y.as */</span><br><span class="line">public final class C32688as &#123;</span><br><span class="line">	/* renamed from: CN */</span><br><span class="line">    public static C7656n m69428CN() &#123;</span><br><span class="line">        C1693g.m4270Dr();</span><br><span class="line">        return C1693g.m4268Dp().f13865gRu;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>再看C7656n调用类：好吧只看mo13442a这一个方法就行了，这个就是通过好友的开始方法了；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">/* renamed from: com.tencent.mm.ad.n */</span><br><span class="line">public final class C7656n implements C1125e &#123;</span><br><span class="line">	/* renamed from: a */</span><br><span class="line">    public final boolean mo13442a(C1138k c1138k, int i) &#123;</span><br><span class="line">        boolean z = c1138k != null || i &gt;= 0;</span><br><span class="line">        Assert.assertTrue(z);</span><br><span class="line">        String str = &quot;worker thread has not been set&quot;;</span><br><span class="line">        if (this.f30978hoG != null) &#123;</span><br><span class="line">            z = true;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            z = false;</span><br><span class="line">        &#125;</span><br><span class="line">        Assert.assertTrue(str, z);</span><br><span class="line">        if (!m15236e(c1138k)) &#123;</span><br><span class="line">            return false;</span><br><span class="line">        &#125;</span><br><span class="line">        m15231b(c1138k, i);</span><br><span class="line">        return true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>我们在看请求的参数：一个类C31589o，好吧，看出来了，就是一个model类。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/* renamed from: com.tencent.mm.pluginsdk.model.o */</span><br><span class="line">public class C31589o extends C1138k implements C1865k &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>综上：我们可以得到最终的静默实现好友验证请求通过了：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">    public void onUpdate(Object database, String path, String table, ContentValues values, String whereClause, String[] whereArgs, int conflictAlgorithm) &#123;</span><br><span class="line">        if (DBConstants.MicroMsg.Fmessage_Conversation.TABLE_NAME.equals(table)) &#123;</span><br><span class="line"></span><br><span class="line">            Integer isNew = values.getAsInteger(DBConstants.MicroMsg.Fmessage_Conversation.COLUMN_isNew);</span><br><span class="line">            String talker = values.getAsString(DBConstants.MicroMsg.Fmessage_Conversation.COLUMN_talker);</span><br><span class="line">            Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; parseRequestContent;isNew.&quot;+isNew);</span><br><span class="line"></span><br><span class="line">            // isNew == 1:新好友请求</span><br><span class="line">            if (isNew != null &amp;&amp; isNew == 1) &#123;</span><br><span class="line">                try &#123;</span><br><span class="line">                    String fmsgContent = values.getAsString(DBConstants.MicroMsg.Fmessage_Conversation.COLUMN_fmsgContent);</span><br><span class="line">                    Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; parseRequestContent;fmsgContent.&quot;+fmsgContent);</span><br><span class="line"></span><br><span class="line">                    JSONObject jsonObject = new XmlToJson.Builder(fmsgContent).build().toJson();</span><br><span class="line">                    JSONObject appMsg = jsonObject.getJSONObject(&quot;msg&quot;);</span><br><span class="line">                    if (fmsgContent == null) &#123;</span><br><span class="line">                        Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; parseRequestContent; appMsg is null, just return.&quot;);</span><br><span class="line">                        return;</span><br><span class="line">                    &#125;</span><br><span class="line">                    Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; &amp;wxid:=&quot; + appMsg.getString(&quot;fromusername&quot;) + &quot;&amp;ticket:&quot; + appMsg.getString(&quot;ticket&quot;) + &quot;&amp;scene:&quot; + appMsg.getInt(&quot;scene&quot;));</span><br><span class="line">                    int state  = Utils.getFCState(talker);</span><br><span class="line">                    Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; state1:&quot;+state);</span><br><span class="line">                    if(state == 1)&#123;</span><br><span class="line">                        report(appMsg.getString(&quot;fromusername&quot;).toString(),</span><br><span class="line">                                appMsg.getString(&quot;fromnickname&quot;).toString(),</span><br><span class="line">                                appMsg.getString(&quot;content&quot;).toString()</span><br><span class="line">                        );</span><br><span class="line">                    &#125;else&#123;</span><br><span class="line">                        final Object instance_y_as_cn = XposedHelpers.callStaticMethod(</span><br><span class="line">                                XposedHelpers.findClass(&quot;com.tencent.mm.y.as&quot;, mWeixinHook.getClassLoader()),</span><br><span class="line">                                &quot;CN&quot;</span><br><span class="line">                        );</span><br><span class="line"></span><br><span class="line">                        String username = appMsg.getString(&quot;fromusername&quot;).toString();</span><br><span class="line">                        String ticket = appMsg.getString(&quot;ticket&quot;).toString();</span><br><span class="line">                        int scene = appMsg.getInt(&quot;scene&quot;);</span><br><span class="line">                        Class&lt;?&gt; class_model_o = XposedHelpers.findClass(&quot;com.tencent.mm.pluginsdk.model.o&quot;, mWeixinHook.getClassLoader());</span><br><span class="line">                        Object request = XposedHelpers.newInstance(class_model_o, username, ticket, scene);</span><br><span class="line"></span><br><span class="line">                        Object result = XposedHelpers.callMethod(instance_y_as_cn, &quot;a&quot;, request, 0);</span><br><span class="line">                        Log.e(WeixinHook.TAG, &quot;DBEventReceiveFriendsVerify; result; &quot; + result);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125; catch (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>测试一下，搞定。</p>
<h2 id="参考资源"><a href="#参考资源" class="headerlink" title="参考资源"></a>参考资源</h2><p><a href="https://api.xposed.info/reference/packages.html" target="_blank" rel="noopener">https://api.xposed.info/reference/packages.html</a></p>
<p><a href="https://bintray.com/rovo89/de.robv.android.xposed/api" target="_blank" rel="noopener">https://bintray.com/rovo89/de.robv.android.xposed/api</a></p>
<p><a href="http://www.infoq.com/cn/articles/android-in-depth-xposed" target="_blank" rel="noopener">http://www.infoq.com/cn/articles/android-in-depth-xposed</a></p>
<p><a href="https://blog.csdn.net/u012417380/article/details/55254369?locationNum=13&amp;fps=1" target="_blank" rel="noopener">https://blog.csdn.net/u012417380/article/details/55254369?locationNum=13&amp;fps=1</a></p>
<p><a href="https://www.cnblogs.com/gordon0918/p/6732100.html" target="_blank" rel="noopener">https://www.cnblogs.com/gordon0918/p/6732100.html</a></p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Xposed </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[MIUI权限检测之路]]></title>
      <url>/2019/07/02/permissioncheck/</url>
      <content type="html"><![CDATA[<h2 id="问题与需求"><a href="#问题与需求" class="headerlink" title="问题与需求"></a>问题与需求</h2><p>在业务线在使用过程中，发生了一些权限状态丢失的情况。而在我们的群控平台中，如果某些权限的设置状态丢失，则群控平台绝大多数功能不能执行。尤其是HRG业务人员，它们不仅需要群控自动执行功能指令，还不能影响手动操作。所以在权限状态丢失后，产品提出了一个权限检测的需求。这个需求就是在我们的平台中检测应用的权限列表，获取权限的当前状态。用于提示使用者，当前的群控在权限设置上是否已经被允许。</p>
<a id="more"></a>
<h2 id="权限介绍"><a href="#权限介绍" class="headerlink" title="权限介绍"></a>权限介绍</h2><p>一个Android应用默认情况下是不拥有任何权限的,  在默认情况下, 一个应用是没有权利去进行一些可能会造成不好影响的操作的. 这些不好的影响可能是对其它应用,操作系统,或者是用户.<br>如果应用需要某些额外的能力,则需要在AndroidManifest.xml中静态地声明相应的权限.<br>也就是我们在AndroidManifest.xml注册了一系列uses-permission，这些permission就是我们需要申请的权限。</p>
<p>在Android 6.0发布之前, 所有的权限都在安装应用的时候显示给用户,用户选择安装则表示全部接受这些权限, 之后无法撤销对这些权限的授权.<br>但是从Android 6.0开始, 一部分比较危险的权限需要在程序运行请求用户授权.<br>至于什么时候需要授权,由应用程序自己决定.而这些权限，就是我们所说的运行时权限。<br>而对于其他权限,认为不是很危险,所以仍然保持原来的做法,在用户安装应用程序时就予以授权.<br>需要注意的是,在设置中,对于应用的危险权限,用户可以选择性地进行授权或者关闭.</p>
<p>Dangerous Permissions主要有：</p>
<table style="margin-left: auto; margin-right: auto;">
<tbody>
<tr><th>Permission Group</th><th>Permissions</th></tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#CALENDAR" target="_blank" rel="noopener">CALENDAR</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#READ_CALENDAR" target="_blank" rel="noopener">READ_CALENDAR</a></code></li>
</ul>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#WRITE_CALENDAR" target="_blank" rel="noopener">WRITE_CALENDAR</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#CAMERA" target="_blank" rel="noopener">CAMERA</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#CAMERA" target="_blank" rel="noopener">CAMERA</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#CONTACTS" target="_blank" rel="noopener">CONTACTS</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#READ_CONTACTS" target="_blank" rel="noopener">READ_CONTACTS</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#WRITE_CONTACTS" target="_blank" rel="noopener">WRITE_CONTACTS</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#GET_ACCOUNTS" target="_blank" rel="noopener">GET_ACCOUNTS</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#LOCATION" target="_blank" rel="noopener">LOCATION</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#ACCESS_FINE_LOCATION" target="_blank" rel="noopener">ACCESS_FINE_LOCATION</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#ACCESS_COARSE_LOCATION" target="_blank" rel="noopener">ACCESS_COARSE_LOCATION</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#MICROPHONE" target="_blank" rel="noopener">MICROPHONE</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#RECORD_AUDIO" target="_blank" rel="noopener">RECORD_AUDIO</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#PHONE" target="_blank" rel="noopener">PHONE</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#READ_PHONE_STATE" target="_blank" rel="noopener">READ_PHONE_STATE</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#CALL_PHONE" target="_blank" rel="noopener">CALL_PHONE</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#READ_CALL_LOG" target="_blank" rel="noopener">READ_CALL_LOG</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#WRITE_CALL_LOG" target="_blank" rel="noopener">WRITE_CALL_LOG</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#ADD_VOICEMAIL" target="_blank" rel="noopener">ADD_VOICEMAIL</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#USE_SIP" target="_blank" rel="noopener">USE_SIP</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#PROCESS_OUTGOING_CALLS" target="_blank" rel="noopener">PROCESS_OUTGOING_CALLS</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#SENSORS" target="_blank" rel="noopener">SENSORS</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#BODY_SENSORS" target="_blank" rel="noopener">BODY_SENSORS</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#SMS" target="_blank" rel="noopener">SMS</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#SEND_SMS" target="_blank" rel="noopener">SEND_SMS</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#RECEIVE_SMS" target="_blank" rel="noopener">RECEIVE_SMS</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#READ_SMS" target="_blank" rel="noopener">READ_SMS</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#RECEIVE_WAP_PUSH" target="_blank" rel="noopener">RECEIVE_WAP_PUSH</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#RECEIVE_MMS" target="_blank" rel="noopener">RECEIVE_MMS</a></code></li>
</ul>
</td>
</tr>
<tr>
<td><code><a href="https://developer.android.com/reference/android/Manifest.permission_group.html#STORAGE" target="_blank" rel="noopener">STORAGE</a></code></td>
<td>
<ul>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#READ_EXTERNAL_STORAGE" target="_blank" rel="noopener">READ_EXTERNAL_STORAGE</a></code></li>
<li><code><a href="https://developer.android.com/reference/android/Manifest.permission.html#WRITE_EXTERNAL_STORAGE" target="_blank" rel="noopener">WRITE_EXTERNAL_STORAGE</a></code></li>
</ul>
</td>
</tr>
</tbody>
</table>        

<p>而通过上述危险权限来看，是有了组的概念，只要我们授权了其中一个权限，那就授权当前组的所有全新啊。而我们可以通过下面的方法获取到所有的申请权限：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">PackageManager packageManager = this.getPackageManager();</span><br><span class="line">PackageInfo packageInfo =packageManager.getPackageInfo(packageName, PackageManager.GET_PERMISSIONS);</span><br><span class="line">String[] usesPermissionsArray = packageInfo.requestedPermissions;</span><br></pre></td></tr></table></figure>

<h2 id="实现历程"><a href="#实现历程" class="headerlink" title="实现历程"></a>实现历程</h2><h3 id="1-App-Ops"><a href="#1-App-Ops" class="headerlink" title="1.App Ops"></a>1.App Ops</h3><p>Google在SDK19中引入了AppOps的权限管理方式，AppOpsManager是对外的管理接口，真正实现功能的是AppOpsService。AppOpsManager里面有两个比较重要的方法:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">AppOpsManager::checkOp(int op ,int uid ,String packageName) （hide方法)</span><br><span class="line">AppOpsManager::checkOp(String op,int uid ,String packageName)（public方法）</span><br></pre></td></tr></table></figure>

<p>所以我们可以用第二个方式检测权限的状态，uid和packageName我们可以拿到，但是op是什么呢，通过查找我们发现AppOpsManager提供了一个函数permissionToOp，通过这个函数我们可以，我们可以把标题1中获取到的uses-permission转换成op，然后我们就可以利用checkOp获取到权限的状态结果了。<br>但是在实际的操作中我们发现。发生了一个SecurityException异常。这个是为什么呢，我们通过查看源码发现。permissionToOp可能为空，这个是因为，我们标题1中获取到的permission，不一定有对应的op值。部分展示如下所示：我们发现其中有好多null值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * This maps each operation to the public string constant for it.</span><br><span class="line"> * If it doesn&apos;t have a public string constant, it maps to null.</span><br><span class="line"> */</span><br><span class="line">private static String[] sOpToString = new String[] &#123;</span><br><span class="line">        OPSTR_COARSE_LOCATION,</span><br><span class="line">        OPSTR_FINE_LOCATION,</span><br><span class="line">        null,</span><br><span class="line">        null,</span><br><span class="line">        OPSTR_READ_CONTACTS,</span><br><span class="line">        OPSTR_WRITE_CONTACTS,</span><br><span class="line">        OPSTR_READ_CALL_LOG,</span><br><span class="line">        ......,</span><br><span class="line">        ......,</span><br><span class="line">        ......,</span><br><span class="line">        ......,</span><br><span class="line">        ......,</span><br><span class="line">        null,</span><br><span class="line">        OPSTR_USE_FINGERPRINT,</span><br><span class="line">        OPSTR_BODY_SENSORS,</span><br><span class="line">        OPSTR_READ_CELL_BROADCASTS,</span><br><span class="line">        OPSTR_MOCK_LOCATION,</span><br><span class="line">        OPSTR_READ_EXTERNAL_STORAGE,</span><br><span class="line">        OPSTR_WRITE_EXTERNAL_STORAGE,</span><br><span class="line">        null,</span><br><span class="line">        OPSTR_GET_ACCOUNTS,</span><br><span class="line">        null,</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>结论：</p>
<p>1、通过permissionToOp和checkOp将不能满足我们的需求。</p>
<p>2、我们发现AndroidManifest.xml中的权限要比小米手机权限列表中的要多。</p>
<h3 id="2-SecurityCenter"><a href="#2-SecurityCenter" class="headerlink" title="2.SecurityCenter"></a>2.SecurityCenter</h3><p>SecurityCenter是什么，它是小米手机权限管理的apk，通过反编译，我们可以一步步的发现小米手机获取权限列表状态的实现方式。粘一下小米的实现核心代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">public PermissionList loadInBackground() &#123;</span><br><span class="line">        PermissionList permissionList = new PermissionList();</span><br><span class="line">        permissionList.isEnabled = isEnabled();</span><br><span class="line">        HashMap cB = packagePermisson(this.mContext, packageName);</span><br><span class="line"></span><br><span class="line">        ArrayList&lt;PermissionBean&gt; arrayList = new ArrayList();</span><br><span class="line">        permissionList.hashMap = cB;</span><br><span class="line">        permissionList.PermissionBeanList = arrayList;</span><br><span class="line">        if (cB != null) &#123;</span><br><span class="line">            Iterable&lt;PermissionGroupInfo&gt; boo = mo5980boo(0);</span><br><span class="line">            Iterable&lt;PermissionInfo&gt; bop = mo5981bop(0);</span><br><span class="line">            Set keySet = cB.keySet();</span><br><span class="line">            HashMap hashMap = new HashMap();</span><br><span class="line">            for (PermissionGroupInfo permissionGroupInfo : boo) &#123;</span><br><span class="line">                PermissionBean permissionBean = new PermissionBean();</span><br><span class="line">                permissionBean.permissionGroupInfo = permissionGroupInfo;</span><br><span class="line">                hashMap.put(Integer.valueOf(permissionGroupInfo.getId()), permissionBean);</span><br><span class="line">                arrayList.add(permissionBean);</span><br><span class="line">            &#125;</span><br><span class="line">            for (PermissionInfo permissionInfo : bop) &#123;</span><br><span class="line">                if (keySet.contains(Long.valueOf(permissionInfo.getId()))) &#123;</span><br><span class="line">                    PermissionBean permissionBean2 = (PermissionBean) hashMap.get(Integer.valueOf(permissionInfo.getGroup()));</span><br><span class="line">                    if (permissionBean2 != null) &#123;</span><br><span class="line">                        permissionBean2.permissionInfoArrayList.add(permissionInfo);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            ArrayList&lt;PermissionBean&gt; arrayList2 = new ArrayList();</span><br><span class="line">            for (PermissionBean permissionBean3 : arrayList) &#123;</span><br><span class="line">                if (permissionBean3.permissionInfoArrayList.size() == 0) &#123;</span><br><span class="line">                    arrayList2.add(permissionBean3);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            for (PermissionBean permissionBean32 : arrayList2) &#123;</span><br><span class="line">                arrayList.remove(permissionBean32);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        return permissionList;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>其中，packagePermisson，mo5980boo，mo5981bop，都是通过ContentResolver跨进程获取到的，然后把获取到的权限分组拼装即可。所以，通过这种方式，我们获取到的权限状态和小米手机的权限列表是一致的。</p>
<p>结论：</p>
<p>因为上述实现是基于note 4x手机的安全中心获取的，所以没有问题。但是我们的手机型号不止是4x手机，还有其他小米手机，但我在其他手机上运行的时候，发现报错，出现没有miui.permission.READ_AND_WIRTE_PERMISSION_MANAGER的异常。所以，这种实现方式，不能支撑所有手机。</p>
<h3 id="3-AppOpsX"><a href="#3-AppOpsX" class="headerlink" title="3.AppOpsX"></a>3.AppOpsX</h3><p>是一个第三方权限管理的实现，通过调用appops的权限管理器，控制权限管理。<br>[Github:<a href="https://github.com/8enet/AppOpsX]" target="_blank" rel="noopener">https://github.com/8enet/AppOpsX]</a> (<a href="https://github.com/8enet/AppOpsX),接入AppOpsX后，可以支撑所有小米手机，但是获取到的权限列表不能和小米手机的权限中心一致，这个会导致产品和运营有一定的误解，并且接入比较困难，可能对今天版本的兼容也会有问题。" target="_blank" rel="noopener">https://github.com/8enet/AppOpsX),接入AppOpsX后，可以支撑所有小米手机，但是获取到的权限列表不能和小米手机的权限中心一致，这个会导致产品和运营有一定的误解，并且接入比较困难，可能对今天版本的兼容也会有问题。</a></p>
<h3 id="4-checkSelfPermission"><a href="#4-checkSelfPermission" class="headerlink" title="4.checkSelfPermission"></a>4.checkSelfPermission</h3><h4 id="ContextCompat"><a href="#ContextCompat" class="headerlink" title="ContextCompat"></a>ContextCompat</h4><p>Android 6.0 变更:<br>此版本引入了一种新的权限模式，如今，用户可直接在运行时管理应用权限。这种模式让用户能够更好地了解和控制权限，同时为应用开发者精简了安装和自动更新过程。用户可为所安装的各个应用分别授予或撤销权限。</p>
<p>对于以 Android 6.0（API 级别 23）或更高版本为目标平台的应用，请务必在运行时检查和请求权限。要确定您的应用是否已被授予权限，请调用新增的 checkSelfPermission() 方法。要请求权限，请调用新增的 requestPermissions() 方法。即使您的应用并不以 Android 6.0（API 级别 23）为目标平台，您也应该在新权限模式下测试您的应用。</p>
<p>如需了解有关在您的应用中支持新权限模式的详情，请参阅使用系统权限。如需了解有关如何评估新模式对应用的影响的提示，请参阅权限最佳做法。</p>
<p>![checkSelfPermission]<br>(<a href="https://github.com/YlJava110/photo/blob/master/pms/20181124152335.png?raw=true" target="_blank" rel="noopener">https://github.com/YlJava110/photo/blob/master/pms/20181124152335.png?raw=true</a>)<br>从上图可知，最终的check会到PackageManagerService. checkComponentPermission,而checkComponentPermission最终调用了</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">@Override</span><br><span class="line">public int checkUidPermission(String permName, int uid) &#123;</span><br><span class="line">    final int userId = UserHandle.getUserId(uid);</span><br><span class="line"></span><br><span class="line">    if (!sUserManager.exists(userId)) &#123;</span><br><span class="line">        return PackageManager.PERMISSION_DENIED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    synchronized (mPackages) &#123;</span><br><span class="line">        Object obj = mSettings.getUserIdLPr(UserHandle.getAppId(uid));</span><br><span class="line">        if (obj != null) &#123;</span><br><span class="line">            final SettingBase ps = (SettingBase) obj;</span><br><span class="line">            final PermissionsState permissionsState = ps.getPermissionsState();</span><br><span class="line">            if (permissionsState.hasPermission(permName, userId)) &#123;</span><br><span class="line">                return PackageManager.PERMISSION_GRANTED;</span><br><span class="line">            &#125;</span><br><span class="line">            // Special case: ACCESS_FINE_LOCATION permission includes ACCESS_COARSE_LOCATION</span><br><span class="line"> if (Manifest.permission.ACCESS_COARSE_LOCATION.equals(permName) &amp;&amp; permissionsState</span><br><span class="line">                    .hasPermission(Manifest.permission.ACCESS_FINE_LOCATION, userId)) &#123;</span><br><span class="line">                return PackageManager.PERMISSION_GRANTED;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; else &#123;</span><br><span class="line">            ArraySet&lt;String&gt; perms = mSystemPermissions.get(uid);</span><br><span class="line">            if (perms != null) &#123;</span><br><span class="line">                if (perms.contains(permName)) &#123;</span><br><span class="line">                    return PackageManager.PERMISSION_GRANTED;</span><br><span class="line">                &#125;</span><br><span class="line">                if (Manifest.permission.ACCESS_COARSE_LOCATION.equals(permName) &amp;&amp; perms</span><br><span class="line">                        .contains(Manifest.permission.ACCESS_FINE_LOCATION)) &#123;</span><br><span class="line">                    return PackageManager.PERMISSION_GRANTED;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return PackageManager.PERMISSION_DENIED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这里最重要的就是mSettings，所有的权限信息都通过mSettings来获取，但是mSettings是都做了什么操作呢？看下边的图：</p>
<figure class="image-box">
                <img src="https://github.com/YlJava110/photo/blob/master/pms/20181126105443.png?raw=true" alt="setting" title class>
                <p>setting</p>
            </figure>
<p>Android6.0之前会吧所有的权限都放置在data/system/packages.xml文件中。Android6.0之后，分为运行时权限跟普通权限，普通权限还是放在data/system/packages.xml中，运行时权限防止在data/system/users/0/runtime-permissions.xml文件中。根据运行时是否动态申请去更新权限。而对于普通权限，一直都为true。<br>具体的实例信息如下：</p>
<p><strong><em>packages.xml</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&lt;package name=&quot;com.permisison.naga&quot; codePath=&quot;/data/app/com.wuba.tinyhand-2&quot; nativeLibraryPath=&quot;/data/app/com.wuba.tinyhand-2/lib&quot; primaryCpuAbi=&quot;armeabi&quot; publicFlags=&quot;944291398&quot; privateFlags=&quot;0&quot; ft=&quot;166817e48c8&quot; it=&quot;16615425c49&quot; ut=&quot;166817e51fc&quot; version=&quot;2540&quot; userId=&quot;10141&quot;&gt;</span><br><span class="line">        &lt;sigs count=&quot;1&quot;&gt;</span><br><span class="line">            &lt;cert index=&quot;11&quot; /&gt;</span><br><span class="line">        &lt;/sigs&gt;</span><br><span class="line">        &lt;perms&gt;</span><br><span class="line">            &lt;item name=&quot;android.permission.WRITE_SETTINGS&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;</span><br><span class="line">            &lt;item name=&quot;android.permission.RESTART_PACKAGES&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;</span><br><span class="line">            &lt;item name=&quot;android.permission.SYSTEM_ALERT_WINDOW&quot; granted=&quot;true&quot; flags=&quot;0&quot; /&gt;</span><br><span class="line">        &lt;/perms&gt;</span><br><span class="line">        &lt;proper-signing-keyset identifier=&quot;28&quot; /&gt;</span><br><span class="line">    &lt;/package&gt;</span><br></pre></td></tr></table></figure>

<p><strong><em>runtime-permissions.xml</em></strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;pkg name=&quot;com.permisison.naga&quot;&gt;</span><br><span class="line">    &lt;item name=&quot;android.permission.ACCESS_COARSE_LOCATION&quot; granted=&quot;true&quot; flags=&quot;2&quot; /&gt;</span><br><span class="line">    &lt;item name=&quot;android.permission.READ_PHONE_STATE&quot; granted=&quot;true&quot; flags=&quot;2&quot; /&gt;</span><br><span class="line">    &lt;item name=&quot;android.permission.SEND_SMS&quot; granted=&quot;false&quot; flags=&quot;2&quot; /&gt;</span><br><span class="line">    &lt;item name=&quot;android.permission.PROCESS_OUTGOING_CALLS&quot; granted=&quot;true&quot; flags=&quot;2&quot; /&gt;</span><br><span class="line">    &lt;item name=&quot;android.permission.GET_ACCOUNTS&quot; granted=&quot;true&quot; flags=&quot;2&quot; /&gt;</span><br><span class="line">    &lt;item name=&quot;android.permission.WRITE_EXTERNAL_STORAGE&quot; granted=&quot;true&quot; flags=&quot;2&quot; /&gt;</span><br><span class="line">  &lt;/pkg&gt;</span><br></pre></td></tr></table></figure>

<p>结论：</p>
<p>1、checkSelfPermission会分别判断两个xml文件，packages.xml是普通权限，并且一直返回true，runtime-permissions.xml返回的是动态权限的状态，会根据当前设置返回0和-1，0是授予，-1是未被授予权限。</p>
<p>2、国内手机厂商的rom都是修改过了，并且增加了不少自定义的权限，所以这个方法获取的结果是不全的。</p>
<h4 id="PermissionChecker"><a href="#PermissionChecker" class="headerlink" title="PermissionChecker"></a>PermissionChecker</h4><p>直接看下关键代码：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">public static int checkPermission(@NonNull Context context, @NonNull String permission,</span><br><span class="line">        int pid, int uid, String packageName) &#123;</span><br><span class="line">    if (context.checkPermission(permission, pid, uid) == PackageManager.PERMISSION_DENIED) &#123;</span><br><span class="line">        return PERMISSION_DENIED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    String op = AppOpsManagerCompat.permissionToOp(permission);</span><br><span class="line">    if (op == null) &#123;</span><br><span class="line">        return PERMISSION_GRANTED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (packageName == null) &#123;</span><br><span class="line">        String[] packageNames = context.getPackageManager().getPackagesForUid(uid);</span><br><span class="line">        if (packageNames == null || packageNames.length &lt;= 0) &#123;</span><br><span class="line">            return PERMISSION_DENIED;</span><br><span class="line">        &#125;</span><br><span class="line">        packageName = packageNames[0];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    if (AppOpsManagerCompat.noteProxyOp(context, op, packageName)</span><br><span class="line">            != AppOpsManagerCompat.MODE_ALLOWED) &#123;</span><br><span class="line">        return PERMISSION_DENIED_APP_OP;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    return PERMISSION_GRANTED;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>里面有这么一句判断</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">String op = AppOpsManagerCompat.permissionToOp(permission);</span><br><span class="line">if (op == null) &#123;</span><br><span class="line">        return PERMISSION_GRANTED;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p> AppOpsManager返回为null的permission，都返回PERMISSION_GRANTED=0；这个判断就不准确了，如果一个运行时权限，没有在这个里面，那就永远为o了。即使设置了拒绝，也获取不到PERMISSION_DENIED=1。并且，小米手机设置好多10000以上都op自定义权限，肯定是获取不到，并且有些权限还没有permission。</p>
<p>结论：完全不可用。继续尝试</p>
<h3 id="5-AuthManager"><a href="#5-AuthManager" class="headerlink" title="5.AuthManager"></a>5.AuthManager</h3><p>通过上述一些列的验证，都是不可以采用的结论。最终我们再次回到note 4x的实现方案上来。由于再标题2的时候，我们只是调研了获取权限状态的方式，但是没有深入的调研底层实现。所以我们通过一些列跟踪，最终找到具体的实现地方在AuthManager这个app下。</p>
<figure class="image-box">
                <img src="https://github.com/YlJava110/photo/blob/master/pms/20181120115301.png?raw=true" alt="am" title class>
                <p>am</p>
            </figure>
<p>结论：</p>
<p>1、由上图可以看出，小米手机完全自己封装了一层权限管理，它的权限状态都存储在了miui_ngen.db数据库里，并且通过PermissionManager管理并定义了权限的op和android.permission值。</p>
<p>2、既然update时完全操作了db和xml三个文件。那我们是不是可以用反射的方法实现呢？经过实现，利用反射checkOpNoThrow虽然可以获取到具体状态值，但是我们只能获取到当前的权限，不能获取到第三方app的权限，报<br>java.lang.SecurityException: uid 10141 does not have android.permission.UPDATE_APP_OPS_STATS异常。</p>
<p>3、开发过程中，发现某些运行权限op=59的权限不能改变，一致获取到的是0.即授权的状态。<br>所以利用反射我们也不能实现我们的需求，继续。</p>
<h3 id="6-runtime-permissions-xml与appops-xml"><a href="#6-runtime-permissions-xml与appops-xml" class="headerlink" title="6.runtime-permissions.xml与appops.xml"></a>6.runtime-permissions.xml与appops.xml</h3><p>经过调研后发现，当我们在修改权限的状态值时，不仅appops.xml里面的状态值在该比那，而且运行权限runtime-permissions.xml的值也在改变，那我们是不是可以比较两个文件的内容进行获取状态值呢。 首先，我们需要读取文件，但是我们没有读取文件权限，我们需要copy到sdcard进行解析。解析过程如下图：</p>
<figure class="image-box">
                <img src="https://github.com/YlJava110/photo/blob/master/pms/20181120115328.png?raw=true" alt="verify" title class>
                <p>verify</p>
            </figure>

<h3 id="7-miui-ngen-db"><a href="#7-miui-ngen-db" class="headerlink" title="7.miui_ngen.db"></a>7.miui_ngen.db</h3><p>miui_ngen.db是什么？我们都知道是一个数据库文件，而且这个是miui的权限状态管理文件。任何的App权限状态都一一对应的存在了这个文件里。从而由上述6种的操作，我们受到了一定的启发，既然能够拿到xml文件，那我们是不是也可以直接拿到这个db文件，然后直接读取db，获取状态信息呢？经过尝试，好吧，权限检测的最终方案决定下来了，我们完全可以直接读取这个db文件，获取到准确的，和miui权限管理中心一一对应，完全匹配的权限状态。</p>
<p><strong>总结：通过以上步骤的实现过程，我们发现由于国内厂商对rom的定制，可能完全修改或者封装了权限的实现和检测机制，我们通过一步步的测试和添坑，最终还是回到了手机原本自身的检测机制上来，并且这种方式是最准确的方式。</strong></p>
<h2 id="对权限的处理场景"><a href="#对权限的处理场景" class="headerlink" title="对权限的处理场景"></a>对权限的处理场景</h2><p>如果设备运行的是 Android 6.0（API 级别 23）或更高版本，并且应用的 targetSdkVersion 是 23 或更高版本，则应用在运行时向用户请求权限。用户可随时调用权限，因此应用在每次运行时均需检查自身是否具备所需的权限。</p>
<p>如果设备运行的是 Android 5.1（API 级别 22）或更低版本，并且应用的 targetSdkVersion 是 22 或更低版本，则系统会在用户安装应用时要求用户授予权限。如果将新权限添加到更新的应用版本，系统会在用户更新应用时要求授予该权限。用户一旦安装应用，他们撤销权限的唯一方式是卸载应用。</p>
<p>如果设备运行的是 Android 6.0（API 级别 23）或更高版本，并且应用的 targetSdkVersion 是 22 或更低版本， 此时Android系统会把你申请的全部权限都给你 。 用户依然可以进入App的设置界面把权限关闭 ！</p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://developer.android.com/about/versions/marshmallow/android-6.0-changes?hl=zh-cn#behavior-runtime-permissions" target="_blank" rel="noopener">https://developer.android.com/about/versions/marshmallow/android-6.0-changes?hl=zh-cn#behavior-runtime-permissions</a><br><a href="https://blog.csdn.net/lewif/article/details/49124757" target="_blank" rel="noopener">https://blog.csdn.net/lewif/article/details/49124757</a><br><a href="https://blog.csdn.net/happylishang/article/details/53813779" target="_blank" rel="noopener">https://blog.csdn.net/happylishang/article/details/53813779</a><br><a href="https://mp.weixin.qq.com/s/OQRHEufCUXBA3d3DMZXMKQ" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/OQRHEufCUXBA3d3DMZXMKQ</a><br><a href="https://developer.android.com/reference/android/support/v4/content/ContextCompat#checkSelfPermission(android.content.Context,%20java.lang.String)" target="_blank" rel="noopener">https://developer.android.com/reference/android/support/v4/content/ContextCompat#checkSelfPermission(android.content.Context,%20java.lang.String)</a><br><a href="https://developer.android.com/reference/android/content/pm/PackageManager#PERMISSION_DENIED" target="_blank" rel="noopener">https://developer.android.com/reference/android/content/pm/PackageManager#PERMISSION_DENIED</a><br><a href="https://www.jianshu.com/p/0ddd129dd32b" target="_blank" rel="noopener">https://www.jianshu.com/p/0ddd129dd32b</a><br><a href="https://blog.csdn.net/happylishang/article/details/78222788" target="_blank" rel="noopener">https://blog.csdn.net/happylishang/article/details/78222788</a><br><a href="https://www.cnblogs.com/neo-java/p/7117482.html" target="_blank" rel="noopener">https://www.cnblogs.com/neo-java/p/7117482.html</a></p>
]]></content>
      
        <categories>
            
            <category> Android </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Kotlin新手使用笔记]]></title>
      <url>/2019/07/02/kotlinnotes/</url>
      <content type="html"><![CDATA[<h2 id="const关键字"><a href="#const关键字" class="headerlink" title="const关键字"></a>const关键字</h2><p>只读属性使用const关键字之后将没有get方法，举个例子<br>在kotlin文件中，写两个包级属性，一个是const，一个不是const</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">const val i = 1</span><br><span class="line">val j = &quot;A&quot;</span><br></pre></td></tr></table></figure>

<a id="more"></a>
<p>使用java代码访问，访问方式是不同的</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">public class TestConst &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        int i = ConstKt.i;</span><br><span class="line">        ConstKt.getJ();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>一种是使用get方法访问，一种是直接使用类访问。说明const关键字实际上相当于java的static final。<br>需要注意的是，Const只能是kotlin的string和基本类型。<br>其实在object中const相当于@JvmField注解，比如下面的代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">@JvmField</span><br><span class="line">val c = 3</span><br></pre></td></tr></table></figure>

<p>就和</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">const val c = 3</span><br></pre></td></tr></table></figure>

<p>效果一样</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">@JvmField</span><br><span class="line">val TAGS = WeixinHook.TAG + &quot;.Test&quot;</span><br><span class="line">const val TAGSG = WeixinHook.TAG + &quot;.Test&quot;</span><br><span class="line">    </span><br><span class="line">@NotNull</span><br><span class="line">@JvmField</span><br><span class="line">public static final String TAGS = &quot;hotB.wechat.Test&quot;;</span><br><span class="line">@NotNull</span><br><span class="line">public static final String TAGSG = &quot;hotB.wechat.Test&quot;;</span><br></pre></td></tr></table></figure>

<p>在class中</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">private const val TAG = XLog.hotPanel + &quot;DeviceUtil&quot;</span><br><span class="line">class DeviceUtil&#123;&#125;</span><br><span class="line"></span><br><span class="line">生成了另一个文件存储const</span><br><span class="line">public final class DeviceUtilKt &#123;</span><br><span class="line">    /* renamed from: MB */</span><br><span class="line">    private static final long f14MB = 1048576;</span><br><span class="line">    private static final String TAG = &quot;hotPanel.DeviceUtil&quot;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这就是kotlin中const关键字的本质。<br><a href="https://blog.csdn.net/ilovewqf/article/details/78826373" target="_blank" rel="noopener">原文点击</a></p>
<h2 id="静态内部类，常量，三元运算符"><a href="#静态内部类，常量，三元运算符" class="headerlink" title="静态内部类，常量，三元运算符"></a>静态内部类，常量，三元运算符</h2><p>静态内部变量和常量定义方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">companion object &#123;</span><br><span class="line">        private const val MSG_UPDATE_PROGRESS = 1</span><br><span class="line">        private const val MSG_UPDATE_TIME= 1000</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>


<p>静态内部类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class Parent&#123;</span><br><span class="line">    class Child //默认就是 java的 public static</span><br><span class="line">&#125;</span><br><span class="line">fun main(args: Array&lt;String&gt;) &#123;</span><br><span class="line">    val inner = Parent.Child()</span><br><span class="line"> </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>非静态内部类</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class Parent&#123;</span><br><span class="line">    //非静态内部类声明</span><br><span class="line">    inner class Child</span><br><span class="line">&#125;</span><br><span class="line">fun main(args: Array&lt;String&gt;) &#123;</span><br><span class="line">    val inner = Parent().Child()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>内部类访问外部持有类的this</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">class Parent&#123;</span><br><span class="line">    val a:Int = 0</span><br><span class="line">    inner class Child&#123;</span><br><span class="line">        val a:Int = 5</span><br><span class="line">        fun hello()&#123;</span><br><span class="line">            println(this@Parent.a)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fun main(args: Array&lt;String&gt;) &#123;</span><br><span class="line">    val inner = Parent().Child()</span><br><span class="line">    inner.hello()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>三元运算符</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> //Java写法</span><br><span class="line">int size=list!=null?list.size:0</span><br><span class="line">//kotlin写法</span><br><span class="line">val size=if(list!=null) list.size() else 0</span><br></pre></td></tr></table></figure>

<p><a href="https://blog.csdn.net/weixin_34032621/article/details/86817626" target="_blank" rel="noopener">原文点击</a></p>
<h2 id="readLine赋值为空"><a href="#readLine赋值为空" class="headerlink" title="readLine赋值为空"></a>readLine赋值为空</h2><p>Java中有一个判断是 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">if（（str=bufferedReader.readLine()）!= null）</span><br></pre></td></tr></table></figure>

<p>这句话到了kotlin转不过来,java经过强制转换成kotlin，可能最初我们是这么写的 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">var str=bufferedReader.readLine() </span><br><span class="line">while(str != null)&#123; </span><br><span class="line">执行代码 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可是出oom了，问题在哪呢？不说了。最后</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">var line: String</span><br><span class="line">while (true) &#123;</span><br><span class="line">    line = bufferedReader.readLine() ?: break</span><br><span class="line">    buffer.append(line)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="属性"><a href="#属性" class="headerlink" title="属性"></a>属性</h2><p>val:val属性只提供getter</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val usbState: UsbState</span><br><span class="line">    get() = sUsbState.copy()</span><br><span class="line">编译后的：</span><br><span class="line">@NotNull</span><br><span class="line">public final UsbState getUsbState() &#123;</span><br><span class="line">    return UsbMonitor.sUsbState.copy();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>var：默认生成getter，setter方法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">var usbConnected: Boolean = false</span><br><span class="line">public final boolean getUsbConnected() &#123;</span><br><span class="line">    return this.usbConnected;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public final void setUsbConnected(boolean &lt;set-?&gt;) &#123;</span><br><span class="line">    this.usbConnected = &lt;set-?&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="对象表达式-amp-amp-对象声明-amp-amp-伴生对象"><a href="#对象表达式-amp-amp-对象声明-amp-amp-伴生对象" class="headerlink" title="对象表达式 &amp;&amp; 对象声明 &amp;&amp; 伴生对象"></a>对象表达式 &amp;&amp; 对象声明 &amp;&amp; 伴生对象</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">var btn: Button = findViewById(R.id.btn)</span><br><span class="line">// 对象表达式实现匿名内部类</span><br><span class="line">btn.setOnClickListener(object: View.OnClickListener &#123;</span><br><span class="line">    override fun onClick(v: View?) &#123;</span><br><span class="line">        text.setText(&quot;$&#123;text.text&#125; $&#123;++clickTime&#125;&quot;)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line">// OnClickListener是函数式接口，可使用Lambda表达式</span><br><span class="line">btn.setOnClickListener &#123; view -&gt;</span><br><span class="line">    text.setText(&quot;$&#123;text.text&#125; $&#123;++clickTime&#125;&quot;)</span><br><span class="line">&#125;</span><br><span class="line">// 对象声明---单例</span><br><span class="line">object FoodManager &#123;</span><br><span class="line">    var foods: MutableList&lt;String&gt;</span><br><span class="line">    init&#123;</span><br><span class="line">        foods = mutableListOf&lt;String&gt;()</span><br><span class="line">        // 初始化食物池</span><br><span class="line">        for (i in 1..9) &#123;</span><br><span class="line">            foods.add(&quot;food$&#123;i&#125;&quot;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">var foods = FoodManager.foods // 使用对象声明</span><br><span class="line">// 伴生对象---静态成员</span><br><span class="line">interface Outputable&#123;</span><br><span class="line">    fun output(msg: String)</span><br><span class="line">&#125;</span><br><span class="line">class MyClass&#123;</span><br><span class="line">    // 定义的MyClass的伴生对象</span><br><span class="line">    companion object: Outputable&#123;</span><br><span class="line">        val name = ”name属性值” </span><br><span class="line">        </span><br><span class="line">        //重写父接口中的抽象方法</span><br><span class="line">        override fun output(msg: String) &#123;</span><br><span class="line">            for(i in 1..6)&#123;</span><br><span class="line">                println (”&lt;h$(i&#125;&gt;$&#123; msg&#125;&lt;/h$&#123;i&#125;&gt;”)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">fun main(args: Array&lt;String&gt;) &#123;</span><br><span class="line">    // 调用伴生对象里的方法与属性，与调用静态成员一样</span><br><span class="line">    MyClass.output(&quot;fkit.org&quot;)</span><br><span class="line">    println(MyClass.name)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="对象声明定义常量"><a href="#对象声明定义常量" class="headerlink" title="对象声明定义常量"></a>对象声明定义常量</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">object NetUtils &#123;</span><br><span class="line"> /**</span><br><span class="line">     * 移动</span><br><span class="line">     */</span><br><span class="line">    const val PROVIDER_TYPE_MOVE = 1</span><br><span class="line">    /**</span><br><span class="line">     * 联通</span><br><span class="line">     */</span><br><span class="line">    const val PROVIDER_TYPE_UNICOM = 2</span><br><span class="line">    /**</span><br><span class="line">     * 电信</span><br><span class="line">     */</span><br><span class="line">    const val PROVIDER_TYPE_TELECOM = 3</span><br><span class="line"></span><br><span class="line">    val NET_TYPE_MOVE = &quot;10086&quot;</span><br><span class="line">    val NET_TYPE_UNICOM = &quot;10010&quot;</span><br><span class="line">    val NET_TYPE_TELECOM = &quot;10001&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>由于对象声明定义的数据单例，所以一般调用(.java)都会用Class.INSTANCE.getXXXX，(kotlin)会用Class.XXXX，但是如果对象中声明的是const常量，则只能用Class.XXXX调用。<br>举例说明：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">switch (NetUtils.INSTANCE.providerType(WxVersions.CURRENT_APPLICATION)) &#123;</span><br><span class="line">            case NetUtils.PROVIDER_TYPE_MOVE:</span><br><span class="line">                destinationAddress = NetUtils.INSTANCE.getNET_TYPE_MOVE();</span><br><span class="line">                break;</span><br><span class="line">            case NetUtils.PROVIDER_TYPE_UNICOM:</span><br><span class="line">                destinationAddress = NetUtils.INSTANCE.getNET_TYPE_UNICOM();</span><br><span class="line">                break;</span><br><span class="line">            case NetUtils.PROVIDER_TYPE_TELECOM:</span><br><span class="line">                destinationAddress = NetUtils.INSTANCE.getNET_TYPE_TELECOM();</span><br><span class="line">                break;</span><br><span class="line">            default:</span><br><span class="line">                destinationAddress = null;</span><br><span class="line">                break;</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>

<p>反编译后的NetUtils</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">public final class NetUtils &#123;</span><br><span class="line">    public static final NetUtils INSTANCE = new NetUtils();</span><br><span class="line">    @NotNull</span><br><span class="line">    private static final String NET_TYPE_MOVE = NET_TYPE_MOVE;</span><br><span class="line">    @NotNull</span><br><span class="line">    private static final String NET_TYPE_TELECOM = NET_TYPE_TELECOM;</span><br><span class="line">    @NotNull</span><br><span class="line">    private static final String NET_TYPE_UNICOM = NET_TYPE_UNICOM;</span><br><span class="line">    public static final int PROVIDER_TYPE_MOVE = 1;</span><br><span class="line">    public static final int PROVIDER_TYPE_TELECOM = 3;</span><br><span class="line">    public static final int PROVIDER_TYPE_UNICOM = 2;</span><br><span class="line"></span><br><span class="line">    private NetUtils() &#123;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>如果定义的常量没有加const，则在调用的时候要用Class.INSTANCE.getXXXX，但是，这个时候switch，会报constant expression requierd异常。</p>
<p><strong>注意：伴生对象常量定义方式：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">class MicroMsg &#123;</span><br><span class="line">	companion object &#123;</span><br><span class="line">		val DB_NAME = &quot;EnMicroMsg.db&quot;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">而下面这样写法拿不到DB_NAME</span><br><span class="line">class MicroMsg &#123;</span><br><span class="line">	val DB_NAME = &quot;EnMicroMsg.db&quot;</span><br><span class="line">	companion object &#123;</span><br><span class="line">		</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>伴生对象如何生成public static final</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">class MicroMsg &#123;</span><br><span class="line">	companion object &#123;</span><br><span class="line">		 val TYPE_IMG = 1</span><br><span class="line">        val TYPE_FILE = 2</span><br><span class="line">        const val TYPE_VOICE = 3</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line">反编译后</span><br><span class="line">private static final int TYPE_FILE = 2;</span><br><span class="line">private static final int TYPE_IMG = 1;</span><br><span class="line">public static final int TYPE_VOICE = 3;</span><br></pre></td></tr></table></figure>

<h2 id="constructor构造器"><a href="#constructor构造器" class="headerlink" title="constructor构造器"></a>constructor构造器</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">1.主构造器</span><br><span class="line">class MultiTask&lt;TaskData, Result&gt; constructor(private val mTaskItem: TaskItem, private val mRequest: TaskData, private val mTaskCount: Int, private val mDelay: Long = 500) </span><br><span class="line"></span><br><span class="line">2.主构造器可以省略constructor</span><br><span class="line">class MultiTask&lt;TaskData, Result&gt; (private val mTaskItem: TaskItem, private val mRequest: TaskData, private val mTaskCount: Int, private val mDelay: Long = 500) </span><br><span class="line"></span><br><span class="line">3.主构造器如果有@JvmOverloads则不可以省略constructor</span><br><span class="line">class MultiTask&lt;TaskData, Result&gt; @JvmOverloads constructor(private val mTaskItem: TaskItem, private val mRequest: TaskData, private val mTaskCount: Int, private val mDelay: Long = 500) </span><br><span class="line"></span><br><span class="line">4.使用@JvmOverloads注解的主构造器，不可以再有次构造器</span><br><span class="line">	constructor(taskItem: TaskItem,mRequest: TaskData,mTaskCount: Int): this(taskItem, mRequest,mTaskCount,300) &#123;</span><br><span class="line">&#125;</span><br><span class="line">异常，hava the same JVM signature.</span><br></pre></td></tr></table></figure>

<p><strong>构造器几种使用：</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">空构造器</span><br><span class="line">class OuterConstructor&#123;&#125;</span><br><span class="line"></span><br><span class="line">私有构造器</span><br><span class="line">class OuterConstructor private constructor(str:String, ins:Int)&#123;&#125;</span><br><span class="line"></span><br><span class="line">私有构造器+次构造器（可调）</span><br><span class="line">class OuterConstructor private constructor(str:String, ins:Int)&#123;</span><br><span class="line">    var s1 = &quot;123&quot;</span><br><span class="line">    init&#123;</span><br><span class="line">        this.s1 = str</span><br><span class="line">    &#125;</span><br><span class="line">    constructor(str:String):this(str,8)</span><br><span class="line">&#125;</span><br><span class="line">主构造器</span><br><span class="line">class OuterConstructor constructor(str:String, ins:Int)&#123;</span><br><span class="line">    var s1 = &quot;123&quot;</span><br><span class="line">    init&#123;</span><br><span class="line">        this.s1 = str</span><br><span class="line">    &#125;</span><br><span class="line">    constructor(str:String):this(str,8)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">主构造器省略初始化init</span><br><span class="line">class OuterConstructor &#123;</span><br><span class="line">    var s1 = &quot;123&quot;</span><br><span class="line">    init&#123;</span><br><span class="line">        this.s1 = &quot;qdf&quot;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">主构造器初始化init</span><br><span class="line">class OuterConstructor constructor(str:String, ins:Int)&#123;</span><br><span class="line">    var s1 = &quot;123&quot;</span><br><span class="line">    init&#123;</span><br><span class="line">        this.s1 = str</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="JvmOverloads作用"><a href="#JvmOverloads作用" class="headerlink" title="@JvmOverloads作用"></a>@JvmOverloads作用</h3><p>在有默认参数值的方法中使用@JvmOverloads注解，则Kotlin就会暴露多个重载方法。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">@JvmOverloads fun f(a: String, b: Int=0, c:String=&quot;abc&quot;)&#123;</span><br><span class="line">&#125;</span><br><span class="line">反编译后：</span><br><span class="line">void f(String a)</span><br><span class="line">void f(String a, int b)</span><br><span class="line">void f(String a, int b, String c)</span><br></pre></td></tr></table></figure>

<p>所以@JvmOverloads不仅仅用于构造方法。</p>
<h3 id="constructor中参数指定val-var和没有制定的区别"><a href="#constructor中参数指定val-var和没有制定的区别" class="headerlink" title="constructor中参数指定val,var和没有制定的区别"></a>constructor中参数指定val,var和没有制定的区别</h3><h4 id="不指定"><a href="#不指定" class="headerlink" title="不指定"></a>不指定</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">class OuterConstructor constructor(mHookConfig: HookConfig) </span><br><span class="line">反编译后</span><br><span class="line">public AvatarServiceImplKT(@NotNull HookConfig mHookConfig) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="val"><a href="#val" class="headerlink" title="val"></a>val</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class OuterConstructor constructor(val mHookConfig: HookConfig) </span><br><span class="line">反编译后</span><br><span class="line">private final HookConfig mHookConfig;</span><br><span class="line">public AvatarServiceImplKT(@NotNull HookConfig mHookConfig) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h4 id="var"><a href="#var" class="headerlink" title="var"></a>var</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">class OuterConstructor constructor(var mHookConfig: HookConfig) </span><br><span class="line">反编译后</span><br><span class="line">private HookConfig mHookConfig;</span><br><span class="line">public AvatarServiceImplKT(@NotNull HookConfig mHookConfig) &#123;&#125;</span><br></pre></td></tr></table></figure>

<h2 id="vararg可变参数"><a href="#vararg可变参数" class="headerlink" title="vararg可变参数"></a>vararg可变参数</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">fun print(vararg msgs: String) &#123;</span><br><span class="line">    for (msg in msgs) &#123;</span><br><span class="line">    	println(msg)</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">fun LogPrinters()&#123;</span><br><span class="line">	print(&quot;11&quot;,&quot;22&quot;,&quot;33&quot;,&quot;44&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但是如果是下面这样调用是不可以的，会报参数匹配异常：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val array = arrayOf(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;, &quot;d&quot;)</span><br><span class="line">print(array)</span><br></pre></td></tr></table></figure>

<p>如果想调用，需要使用*操作符：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(*array)</span><br></pre></td></tr></table></figure>

<p>所以我们调用带有可变参数的方法时，只能传递离散的参数值，直接传递数组会报语法错误。但是当我们手头上就是一个数组，要想传递，就需要借助运算符*(spread operator)：相当于将数组分散成一个个的个体再传入进去。</p>
<h2 id="var-get-set-xxx-方法"><a href="#var-get-set-xxx-方法" class="headerlink" title="var get() set(xxx)方法"></a>var get() set(xxx)方法</h2><p>1.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">override var name: String=&quot;ninhao&quot;</span><br><span class="line">	get() = field</span><br><span class="line">	set(value) &#123;</span><br><span class="line">		field=value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>调用</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">XLog.e(&quot;------name1:&quot;,name)</span><br><span class="line">name = &quot;henhao&quot;</span><br><span class="line">XLog.e(&quot;------name2:&quot;,name)</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ninhao</span><br><span class="line">henhao</span><br></pre></td></tr></table></figure>

<p>注意：var name: String=”ninhao”，必须初始化。<br>2.可以通过fun get() 和fun set(XXX)实现。</p>
<p>3.<br>错误写法：死循环</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">var name: String</span><br><span class="line">	get() = name</span><br><span class="line">	set(value) &#123;</span><br><span class="line">	name=&quot;afff&quot;</span><br><span class="line">&#125;</span><br><span class="line">反编译后</span><br><span class="line"></span><br><span class="line">@NotNull</span><br><span class="line">public String getName() &#123;</span><br><span class="line">    return getName();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public void setName(@NotNull String value) &#123;</span><br><span class="line">    Intrinsics.checkParameterIsNotNull(value, UserInfo.COLUMN_value);</span><br><span class="line">    setName(&quot;afff&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><a href="https://www.runoob.com/kotlin/kotlin-class-object.html" target="_blank" rel="noopener">详细注解链接</a></p>
<h2 id="split"><a href="#split" class="headerlink" title="split"></a>split</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">var sb = StringBuilder()</span><br><span class="line">sb.append(&quot;111,&quot;).append(&quot;222,&quot;).append(&quot;333,&quot;).append(&quot;,&quot;).append(&quot;aaa,&quot;).append(&quot;bbb,&quot;).append(&quot;ccc,&quot;).append(&quot;&quot;)</span><br><span class="line">val strs = sb.toString()</span><br><span class="line">val splits = strs.split(&quot;,&quot;.toRegex()).dropWhile &#123; !it.isEmpty() &#125;.toTypedArray()</span><br><span class="line">for(str in splits)&#123;</span><br><span class="line">	XLog.e(&quot;-------split:&quot;,str)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>1.<strong>dropWhile</strong> 返回从第一项起，去掉满足条件的元素，直到不满足条件的一项为止；<br>it.isEmpty():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[-------split:][main]</span><br><span class="line">[-------split:][main]aaa</span><br><span class="line">[-------split:][main]bbb</span><br><span class="line">[-------split:][main]ccc</span><br><span class="line">[-------split:][main]</span><br></pre></td></tr></table></figure>

<p>!it.isEmpty():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[-------split:][main]111</span><br><span class="line">[-------split:][main]222</span><br><span class="line">[-------split:][main]333</span><br><span class="line">[-------split:][main]</span><br><span class="line">[-------split:][main]aaa</span><br><span class="line">[-------split:][main]bbb</span><br><span class="line">[-------split:][main]ccc</span><br><span class="line">[-------split:][main]</span><br></pre></td></tr></table></figure>

<p>2.<strong>dropLastWhile</strong> 返回从最后一项起，去掉满足条件的元素，直到不满足条件的一项为止；<br>it.isEmpty():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">[-------split:][main]111</span><br><span class="line">[-------split:][main]222</span><br><span class="line">[-------split:][main]333</span><br><span class="line">[-------split:][main]</span><br><span class="line">[-------split:][main]aaa</span><br><span class="line">[-------split:][main]bbb</span><br><span class="line">[-------split:][main]ccc</span><br></pre></td></tr></table></figure>

<p>!it.isEmpty():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[-------split:][main]111</span><br><span class="line">[-------split:][main]222</span><br><span class="line">[-------split:][main]333</span><br><span class="line">[-------split:][main]</span><br><span class="line">[-------split:][main]aaa</span><br><span class="line">[-------split:][main]bbb</span><br><span class="line">[-------split:][main]ccc</span><br><span class="line">[-------split:][main]</span><br></pre></td></tr></table></figure>

<p>3.<strong>drop</strong> 返回去掉前n个元素后的列表；<br>drop(4)</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[-------split:][main]aaa</span><br><span class="line">[-------split:][main]bbb</span><br><span class="line">[-------split:][main]ccc</span><br><span class="line">[-------split:][main]</span><br></pre></td></tr></table></figure>

<p>4.<strong>filter &amp; slice &amp; take</strong></p>
<p>filter–过滤掉所有不满足条件的元素；<br>filterNot–过滤掉所有满足条件的元素；<br>filterNotNull–过滤掉所有值为null的元素；</p>
<p>slice–过滤掉非指定下标的元素，即保留下标对应的元素过滤List中指定下标的元素（比如这里只保留下标为1，3，4的元素），当过滤list中有元素值大于目标List大小时会出现异常；</p>
<p>take–返回从第一个开始的n个元素；<br>takeLast–返回从最后一个开始的n个元素；<br>takeWhile–返回不满足条件的下标前面的所有元素的集合；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">filter &#123; !it.isEmpty() &#125;</span><br><span class="line"></span><br><span class="line">[-------split:][main]111</span><br><span class="line">[-------split:][main]222</span><br><span class="line">[-------split:][main]333</span><br><span class="line">[-------split:][main]aaa</span><br><span class="line">[-------split:][main]bbb</span><br><span class="line">[-------split:][main]ccc</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/tgyf/p/6892551.html?utm_source=itdadao&utm_medium=referral" target="_blank" rel="noopener">参考链接点击</a></p>
<h2 id="显式转换-amp-强制转换"><a href="#显式转换-amp-强制转换" class="headerlink" title="显式转换&amp;强制转换"></a>显式转换&amp;强制转换</h2><p>每个数字类型支持如下的转换:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&gt; toByte(): Byte</span><br><span class="line">&gt; toShort(): Short</span><br><span class="line">&gt; toInt(): Int</span><br><span class="line">&gt; toLong(): Long</span><br><span class="line">&gt; toFloat(): Float</span><br><span class="line">&gt; toDouble(): Double</span><br><span class="line">&gt; toChar(): Char</span><br></pre></td></tr></table></figure>

<p>强制转换<br>xxx as 类：强制转换，可能崩溃</p>
<p>xxx as? 类：安全的强制转换，转换失败返回null</p>
<p><strong>注意：数字类型的转换也可以使用as ，编译时不报错，但运行时会报错。</strong></p>
<h2 id="Lambda-argument-should-be-moved-out-of-parentheses"><a href="#Lambda-argument-should-be-moved-out-of-parentheses" class="headerlink" title="Lambda argument should be moved out of parentheses"></a>Lambda argument should be moved out of parentheses</h2><p>解决方式：option+enter；</p>
<h2 id="return-标签"><a href="#return-标签" class="headerlink" title="return@标签"></a>return@标签</h2><p>跳转到指定的位置，标签的写法很简单，只需要名字之后加@符号，要用的时候@名字就好，一般在lambda表达式中可能会用到。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">fun print(vararg msgs: String) &#123;</span><br><span class="line">        Async.io &#123;</span><br><span class="line">            for (msg in msgs) &#123;</span><br><span class="line">                XLog.e(&quot;-------print:&quot;,msg)</span><br><span class="line">            &#125;</span><br><span class="line">            return@io</span><br><span class="line">            XLog.e(&quot;-------print:&quot;,&quot;8&quot;)</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        XLog.e(&quot;-------print:&quot;,&quot;9&quot;)</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[-------print:][main]9</span><br><span class="line">[-------print:][IOExecutor#1]a</span><br><span class="line">[-------print:][IOExecutor#1]b</span><br><span class="line">[-------print:][IOExecutor#1]c</span><br><span class="line">[-------print:][IOExecutor#1]d</span><br></pre></td></tr></table></figure>

<h2 id="for循环使用方法"><a href="#for循环使用方法" class="headerlink" title="for循环使用方法"></a>for循环使用方法</h2><p>在Kotlin中想遍历1-100的数值可以这样写：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (index in 1..10)&#123;</span><br><span class="line">	print(index)//会输出1..10</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>这样写是正序遍历，如果想倒序遍历就该使用标准库中定义的downTo()函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (index in 10 downTo 1)&#123;</span><br><span class="line">	print(index)//会输出10..1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>想不使用1作为遍历的步长，可以使用step()函数：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (index in 1..100 step 2)&#123;</span><br><span class="line">	print(index)//会输出1..3..5......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>要创建一个不包含末尾元素的区间：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">for (index in 1 until 10)&#123;</span><br><span class="line">	println(index)//输出1..9</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遍历一个数组/列表，想同时取出下标和元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val array = arrayOf(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</span><br><span class="line">for ((index,e) in array.withIndex())&#123;</span><br><span class="line">	println(&quot;下标=$index----元素=$e&quot;)</span><br><span class="line">&#125;</span><br><span class="line">[-----index:][main]下标=0----元素=a</span><br><span class="line">[-----index:][main]下标=1----元素=b</span><br><span class="line">[-----index:][main]下标=2----元素=c</span><br></pre></td></tr></table></figure>

<p>遍历一个数组/列表，只取出下标:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val array = arrayOf(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</span><br><span class="line">for (index in array.indices)&#123;</span><br><span class="line">	println(&quot;index=$index&quot;)//输出0，1，2</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>遍历取元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">val array = arrayOf(&quot;a&quot;, &quot;b&quot;, &quot;c&quot;)</span><br><span class="line">for (element in array)&#123;</span><br><span class="line">	println(&quot;element=$element&quot;)//输出a,b,c</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="class"><a href="#class" class="headerlink" title=".class"></a>.class</h2><p>Service::class.java的语法展现了如何获取java.lang.Class对应的Kotlin类，这和Java中的Service.Class是完全等同的.</p>
<h2 id="java通配符-amp-kotlin声明处型变"><a href="#java通配符-amp-kotlin声明处型变" class="headerlink" title="java通配符&amp;kotlin声明处型变"></a>java通配符&amp;kotlin声明处型变</h2><h3 id="java"><a href="#java" class="headerlink" title="java"></a><strong>java</strong></h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">public static &lt;T&gt; void copy(List&lt;? super T&gt; dest, List&lt;? extends T&gt; src) &#123;</span><br><span class="line">      // 校验略</span><br><span class="line">      ListIterator&lt;? super T&gt; di = dest.listIterator();</span><br><span class="line">      ListIterator&lt;? extends T&gt; si = src.listIterator();</span><br><span class="line">      while (si.hasNext()) &#123;</span><br><span class="line">          /**</span><br><span class="line">           * 编译时异常</span><br><span class="line">           * Incompatible types.不兼容类型；</span><br><span class="line">           * Required:T;</span><br><span class="line">           * Found:Capture&lt;? super T&gt;</span><br><span class="line">           */</span><br><span class="line">          T elementD =di.next();</span><br><span class="line"></span><br><span class="line">          T element = si.next(); //src extent 生产者 作为方法返回值类型是安全的</span><br><span class="line">          di.set(element); // dest super 消费者 作为方法参数类型是安全的</span><br><span class="line"></span><br><span class="line">          /**</span><br><span class="line">           * 编译时异常</span><br><span class="line">           * set(&lt;? extends T&gt;) in ListIterator cannot be applied.</span><br><span class="line">           * to (T)</span><br><span class="line">           */</span><br><span class="line">          si.set(elementD);</span><br><span class="line">      &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure>

<h3 id="kotlin"><a href="#kotlin" class="headerlink" title="kotlin:"></a><strong>kotlin:</strong></h3> <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">abstract class Supplier&lt;out T&gt; &#123;</span><br><span class="line">       abstract fun get(): T</span><br><span class="line">       /**</span><br><span class="line">        * 编译期错误：</span><br><span class="line">        * Type parameter T is declared as &apos;out&apos; but occurs in &apos;in&apos; position in type T</span><br><span class="line">        */</span><br><span class="line">       abstract fun set(t: T)</span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   abstract class Customer&lt;in T&gt; &#123;</span><br><span class="line">       abstract fun set(t: T)</span><br><span class="line">       /**</span><br><span class="line">        * 编译期错误：</span><br><span class="line">        * Type parameter T is declared as &apos;in&apos; but occurs in &apos;out&apos; position in type T</span><br><span class="line">        */</span><br><span class="line">       abstract fun get(): T</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h3 id="1-List-lt-extends-T-gt-协变：-out"><a href="#1-List-lt-extends-T-gt-协变：-out" class="headerlink" title="1.List&lt;? extends T&gt;协变：== out"></a>1.List&lt;? extends T&gt;协变：== out</h3><p> 在si.set(elementD)中， elementD的类型是T，所以我们可以set（T t），以及一切参数中含有 T 的方法（称为消费者方法），T类型或者从T继承的类型都可以被set，但是因为可以set不同的类型，所以这些方法可能会破坏类型安全，所以编译器限制这些方法的调用。</p>
<p> 举kotlin例说明：<br> 有一方法</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun generate(args : Array&lt;Any&gt;)&#123;</span><br><span class="line">//todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 我们调用它：</p>
 <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">val args : Array&lt;String&gt; = arrayOf()</span><br><span class="line">generate(args)</span><br></pre></td></tr></table></figure>

<p> 这个时候会提示异常（类型不匹配）：type mismitch，为了解决这个问题，我们只需要修改一下调用方法，使用型变out即可。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fun generate(args : Array&lt;out Any&gt;)&#123;</span><br><span class="line"> //todo</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="List-lt-super-T-gt-逆变：-in"><a href="#List-lt-super-T-gt-逆变：-in" class="headerlink" title="List&lt;? super T&gt;逆变：== in"></a>List&lt;? super T&gt;逆变：== in</h3><p> 同协变正好相反，在T elementD =di.next();中，因为di的类型是&lt;? super T&gt;，所以我们通过di.next()获取的类型可能T,也可能是从T继承的类型，从而我们不能确定next的类型。注意，这次拒绝的理由跟协变中是不一样的。get方法并不会破坏泛型类的类型安全，主要原因在于我们不能确定get的返回类型。<br> <a href="https://www.jianshu.com/p/0c2948f7e656" target="_blank" rel="noopener">参考链接1</a><br> <a href="https://www.jianshu.com/p/ecacb7af79eb?from=timeline&isappinstalled=0" target="_blank" rel="noopener">参考链接2</a></p>
<h2 id="操作符"><a href="#操作符" class="headerlink" title="?: ?. !!操作符"></a>?: ?. !!操作符</h2><h3 id="If-not-null"><a href="#If-not-null" class="headerlink" title="?. == If not null"></a>?. == If not null</h3><p>?.就是当前面的变量!= nuil 时正常调用，如果为null就为null;并且?.可以连续使用。例如user?.userName?.length</p>
<h3 id="npe"><a href="#npe" class="headerlink" title="!!! == npe"></a>!!! == npe</h3><p>!!,加在变量名后，就是当变量为null时，抛出空指针异常;</p>
<h3 id="if-null"><a href="#if-null" class="headerlink" title="?: == if null"></a>?: == if null</h3><p>?: 仅仅在左边的表达式结果为null时才会计算 ?: 后面的表达式</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">val map = XXXXX ?: return</span><br><span class="line">等同于</span><br><span class="line">val map = XXXXX</span><br><span class="line">if(map == null)&#123;</span><br><span class="line">	return</span><br><span class="line">&#125;</span><br><span class="line">但是if会有://Replace &apos;if&apos; with elvis operator</span><br></pre></td></tr></table></figure>

<h2 id="toString-NaN"><a href="#toString-NaN" class="headerlink" title="toString()"></a>toString()</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/**</span><br><span class="line"> * Returns a string representation of the object. Can be called with a null receiver, in which case</span><br><span class="line"> * it returns the string &quot;null&quot;.</span><br><span class="line"> */</span><br><span class="line">public fun Any?.toString(): String</span><br></pre></td></tr></table></figure>

<p><strong>疑问点：</strong><br>null.toString()<br>反编译<br>String.valueOf(null)</p>
<h2 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">class XXXXKT:Serializable&#123;&#125;</span><br></pre></td></tr></table></figure>

<p>Cannot access ‘Serializable’:it is internal in ‘kotlin.io’</p>
<p>解决：import java.io.Serializable</p>
<h2 id="Suppress-“UNCHECKED-CAST”"><a href="#Suppress-“UNCHECKED-CAST”" class="headerlink" title="@Suppress(“UNCHECKED_CAST”)"></a>@Suppress(“UNCHECKED_CAST”)</h2><p>当使用 as Array<string>强转时可能会出现Unchecked cast: Any! to Array<any> 警告。解决方法就是在强转代码前加@Suppress(“UNCHECKED_CAST”)。<br>备注：@SuppressWarnings(“unchecked”)使用时机呢？</any></string></p>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p><a href="https://www.jianshu.com/p/e6bbc00b18f6" target="_blank" rel="noopener">详细使用点击</a></p>
<h2 id="参考资料"><a href="#参考资料" class="headerlink" title="参考资料"></a>参考资料</h2><p><a href="https://www.runoob.com/kotlin/kotlin-class-object.html" target="_blank" rel="noopener">Runoob</a></p>
<p><a href="https://www.kotlincn.net/docs/reference/basic-syntax.html" target="_blank" rel="noopener">kotlincn</a></p>
<p><a href="https://handsomeliuyang.github.io/2019/05/07/Kotlin%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" target="_blank" rel="noopener">Kotlin学习笔记</a></p>
]]></content>
      
        <categories>
            
            <category> Kotlin </category>
            
        </categories>
        
        
        <tags>
            
            <tag> Android </tag>
            
            <tag> Kotlin </tag>
            
        </tags>
        
    </entry>
    
    <entry>
      <title><![CDATA[Hexo 配置]]></title>
      <url>/2019/07/02/hello-world/</url>
      <content type="html"><![CDATA[<p>通过git+hexo搭建个人博客</p>
<a id="more"></a>
<p>More info: <a href="https://www.cnblogs.com/liuxianan/p/build-blog-website-by-hexo-github.html#%E4%BD%BF%E7%94%A8hexo%E5%86%99%E5%8D%9A%E5%AE%A2" target="_blank" rel="noopener">Deployment</a></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">npm install -g hexo</span><br><span class="line">hexo init</span><br><span class="line">hexo g</span><br><span class="line">hexo s</span><br><span class="line">hexo d</span><br><span class="line">npm install hexo-deployer-git --save</span><br><span class="line">hexo d</span><br><span class="line">npm install hexo --save</span><br><span class="line">hexo new &apos;kotlin使用笔记&apos;</span><br><span class="line">出现异常：使用下面命令，安装所有插件。</span><br><span class="line">npm ls --depth 0</span><br></pre></td></tr></table></figure>

]]></content>
      
        
    </entry>
    
  
  
</search>
